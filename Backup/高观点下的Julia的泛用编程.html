<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>&lt;no title&gt; &#8212; Site-32  documentation</title>
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head><body>

  <div id="navbar" class="navbar navbar-inverse navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../guide.html">
          Site-32</a>
        <span class="navbar-text navbar-version pull-left"><b></b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="../github.html">GitHub</a></li>
                <li><a href="../PL/index.html">PL</a></li>
                <li><a href="../Design/index.html">Design</a></li>
                <li><a href="../DSL/index.html">DSL</a></li>
                <li><a href="index.html">Backup</a></li>
                <li><a href="../Others/index.html">Others</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../guide.html">Site-32 <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Site-32 Index Page</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Compiler/index.html">Compiler</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../Compiler/RBNF.html">RBNF</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Compiler/RBNFRBNF.html">RBNFRBNF</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Compiler/Parserc.html">Parser Combinator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Compiler/完美的编译前端.html">完美的编译前端</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Compiler/非文法变换的左递归处理.html">非文法变换的左递归处理</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Compiler/LLAST.html">LLAST</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Compiler/LLk-2-LR1.html">LL(k) to LL(1)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Design/index.html">Design</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../Design/General-Programming-In-Julia-Language-From-An-Advanced-Standpoint.html">General Programming In Julia Language From An Advanced Standpoint</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../DSL/index.html">DSL</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../DSL/write-your-a-query-language-with-MLStyle.html">Write You A Query Language</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Fiction/index.html">Fiction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../PL/index.html">Programming Language</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../PL/HKT.html">Higher Kinded Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../PL/typeclass.html">Type Classes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../PL/paper-reading-LHKP.html">Paper Reading: Lightweight-Higher-Kinded-Polymorphism</a></li>
<li class="toctree-l2"><a class="reference internal" href="../PL/HKT-typeclass-FSharp.html">Compelling Higher Kinded Types and Type Classes in F#</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Others/index.html">Others</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Sub-sections <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul class="simple">
</ul>
</ul>
</li>
              
            
            
            
            
            
              <li class="hidden-sm">
<div id="sourcelink">
  <a href="../_sources/Backup/高观点下的Julia的泛用编程.rst.txt"
     rel="nofollow">Source</a>
</div></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary">
<form action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
        </div>
      </div>
    <div class="col-md-9 content">
      
  <html lang="zh" data-hairline="true" data-theme="light"><head><meta charSet="utf-8"/><title data-react-helmet="true">高观点下的Julia泛用编程 - 知乎</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"/><meta name="renderer" content="webkit"/><meta name="force-rendering" content="webkit"/><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/><meta name="google-site-verification" content="FTeR0c8arOPKh8c5DYh_9uu98_zJbaWw53J-Sch9MTg"/><meta data-react-helmet="true" name="description" content="高观点下的Julia范用编程Julia是一个支持可选类型标注的纯动态多范式语言。由于其引入的一些像For循环，While循环, If循环, 函数等的基本语言构造, 与Python, R或是MATLAB类似, Julia变得简单和简洁, 使得你可以仅…"/><meta data-react-helmet="true" property="og:title" content="高观点下的Julia泛用编程"/><meta data-react-helmet="true" property="og:url" content="https://zhuanlan.zhihu.com/p/61537058"/><meta data-react-helmet="true" property="og:description" content="高观点下的Julia范用编程Julia是一个支持可选类型标注的纯动态多范式语言。由于其引入的一些像For循环，While循环, If循环, 函数等的基本语言构造, 与Python, R或是MATLAB类似, Julia变得简单和简洁, 使得你可以仅…"/><meta data-react-helmet="true" property="og:image" content="https://pic4.zhimg.com/v2-260c5a5d732d69d7378ffdf01403b92e_b.jpg"/><meta data-react-helmet="true" property="og:type" content="article"/><meta data-react-helmet="true" property="og:site_name" content="知乎专栏"/><link data-react-helmet="true" rel="apple-touch-icon" href="https://static.zhihu.com/heifetz/assets/apple-touch-icon-152.67c7b278.png"/><link data-react-helmet="true" rel="apple-touch-icon" href="https://static.zhihu.com/heifetz/assets/apple-touch-icon-152.67c7b278.png" sizes="152x152"/><link data-react-helmet="true" rel="apple-touch-icon" href="https://static.zhihu.com/heifetz/assets/apple-touch-icon-120.b3e6278d.png" sizes="120x120"/><link data-react-helmet="true" rel="apple-touch-icon" href="https://static.zhihu.com/heifetz/assets/apple-touch-icon-76.7a750095.png" sizes="76x76"/><link data-react-helmet="true" rel="apple-touch-icon" href="https://static.zhihu.com/heifetz/assets/apple-touch-icon-60.a4a761d4.png" sizes="60x60"/><link rel="shortcut icon" type="image/x-icon" href="https://static.zhihu.com/static/favicon.ico"/><link rel="search" type="application/opensearchdescription+xml" href="https://static.zhihu.com/static/search.xml" title="知乎"/><link rel="dns-prefetch" href="//static.zhimg.com"/><link rel="dns-prefetch" href="//pic1.zhimg.com"/><link rel="dns-prefetch" href="//pic2.zhimg.com"/><link rel="dns-prefetch" href="//pic3.zhimg.com"/><link rel="dns-prefetch" href="//pic4.zhimg.com"/><link href="https://static.zhihu.com/heifetz/app.8ccbfb827a296914c6a4.css" rel="stylesheet"/><link rel="stylesheet"/><script defer="" crossorigin="anonymous" src="https://unpkg.zhimg.com/@cfe/sentry-script@latest/dist/init.js" data-sentry-config="{&quot;dsn&quot;:&quot;https://65e244586890460588f00f2987137aa8@crash2.zhihu.com/193&quot;,&quot;sampleRate&quot;:0.1,&quot;release&quot;:&quot;1934-6bce4b72&quot;,&quot;ignoreErrorNames&quot;:[&quot;NetworkError&quot;,&quot;SecurityError&quot;],&quot;ignoreErrors&quot;:[&quot;origin message&quot;,&quot;Network request failed&quot;,&quot;Loading chunk&quot;,&quot;这个系统不支持该功能。&quot;,&quot;Can&#x27;t find variable: webkit&quot;,&quot;Can&#x27;t find variable: $&quot;,&quot;内存不足&quot;,&quot;out of memory&quot;,&quot;DOM Exception 18&quot;,&quot;The operation is insecure&quot;,&quot;[object Event]&quot;,&quot;[object FileError]&quot;,&quot;[object DOMError]&quot;,&quot;[object Object]&quot;,&quot;拒绝访问。&quot;,&quot;Maximum call stack size exceeded&quot;,&quot;UploadError&quot;,&quot;无法 fetch&quot;,&quot;draft-js&quot;,&quot;缺少 JavaScript 对象&quot;,&quot;componentWillEnter&quot;,&quot;componentWillLeave&quot;,&quot;componentWillAppear&quot;,&quot;getInlineStyleAt&quot;,&quot;getCharacterList&quot;],&quot;whitelistUrls&quot;:[&quot;static.zhihu.com&quot;]}"></script></head><body class="WhiteBg-body"><div id="root"><div class="App" data-reactroot=""><div class="LoadingBar"></div><main role="main" class="App-main"><div class="Post-content" data-zop-usertoken="{&quot;userToken&quot;:&quot;&quot;}" data-zop="{&quot;authorName&quot;:&quot;平平淡淡红美铃&quot;,&quot;itemId&quot;:61537058,&quot;title&quot;:&quot;高观点下的Julia泛用编程&quot;,&quot;type&quot;:&quot;article&quot;}"><div class="ColumnPageHeader-Wrapper"><div><div class="Sticky ColumnPageHeader"><div class="ColumnPageHeader-content"><a href="//www.zhihu.com" aria-label="知乎"><svg viewBox="0 0 200 91" class="Icon ZhihuLogo ZhihuLogo--blue Icon--logo" style="height:30px;width:64px" width="64" height="30" aria-hidden="true"><title></title><g><path d="M53.29 80.035l7.32.002 2.41 8.24 13.128-8.24h15.477v-67.98H53.29v67.978zm7.79-60.598h22.756v53.22h-8.73l-8.718 5.473-1.587-5.46-3.72-.012v-53.22zM46.818 43.162h-16.35c.545-8.467.687-16.12.687-22.955h15.987s.615-7.05-2.68-6.97H16.807c1.09-4.1 2.46-8.332 4.1-12.708 0 0-7.523 0-10.085 6.74-1.06 2.78-4.128 13.48-9.592 24.41 1.84-.2 7.927-.37 11.512-6.94.66-1.84.785-2.08 1.605-4.54h9.02c0 3.28-.374 20.9-.526 22.95H6.51c-3.67 0-4.863 7.38-4.863 7.38H22.14C20.765 66.11 13.385 79.24 0 89.62c6.403 1.828 12.784-.29 15.937-3.094 0 0 7.182-6.53 11.12-21.64L43.92 85.18s2.473-8.402-.388-12.496c-2.37-2.788-8.768-10.33-11.496-13.064l-4.57 3.627c1.363-4.368 2.183-8.61 2.46-12.71H49.19s-.027-7.38-2.372-7.38zm128.752-.502c6.51-8.013 14.054-18.302 14.054-18.302s-5.827-4.625-8.556-1.27c-1.874 2.548-11.51 15.063-11.51 15.063l6.012 4.51zm-46.903-18.462c-2.814-2.577-8.096.667-8.096.667s12.35 17.2 12.85 17.953l6.08-4.29s-8.02-11.752-10.83-14.33zM199.99 46.5c-6.18 0-40.908.292-40.953.292v-31.56c1.503 0 3.882-.124 7.14-.376 12.773-.753 21.914-1.25 27.427-1.504 0 0 3.817-8.496-.185-10.45-.96-.37-7.24 1.43-7.24 1.43s-51.63 5.153-72.61 5.64c.5 2.756 2.38 5.336 4.93 6.11 4.16 1.087 7.09.53 15.36.277 7.76-.5 13.65-.76 17.66-.76v31.19h-41.71s.88 6.97 7.97 7.14h33.73v22.16c0 4.364-3.498 6.87-7.65 6.6-4.4.034-8.15-.36-13.027-.566.623 1.24 1.977 4.496 6.035 6.824 3.087 1.502 5.054 2.053 8.13 2.053 9.237 0 14.27-5.4 14.027-14.16V53.93h38.235c3.026 0 2.72-7.432 2.72-7.432z" fill-rule="evenodd"/></g></svg></a><i class="ColumnPageHeader-Line"></i><div class="ColumnPageHeader-Title"><a class="ColumnLink ColumnPageHeader-Link" href="/c_103600054"><img class="Avatar Avatar--round" width="30" height="30" src="https://pic1.zhimg.com/v2-e4e17a71e65bfa141d3f06c1c8d71f8f_is.jpg" srcSet="https://pic1.zhimg.com/v2-e4e17a71e65bfa141d3f06c1c8d71f8f_im.jpg 2x" alt="红红娘的小码坊"/></a><div class="ColumnPageHeader-TitleName"><span class="ColumnPageHeader-TitleMeta">首发于</span><a class="ColumnLink ColumnPageHeader-TitleColumn" href="/c_103600054">红红娘的小码坊</a></div></div><div class="ColumnPageHeader-Button"><button type="button" class="Button ColumnPageHeader-WriteButton Button--blue"><svg class="Zi Zi--EditSurround" fill="currentColor" viewBox="0 0 24 24" width="24" height="24"><path d="M18.453 7.992l-1.833-1.65.964-.978a1.223 1.223 0 0 1 1.73-.012l.005.006a1.24 1.24 0 0 1 .007 1.748l-.873.886zm-1.178 1.194l-5.578 5.66-1.935.697a.393.393 0 0 1-.504-.504l.697-1.935 5.488-5.567 1.832 1.65zM7.58 5.848l5.654.006-1.539 1.991-3.666.012A1.02 1.02 0 0 0 7 8.868v7.993c0 .558.46 1.01 1.029 1.01l7.941-.01c.568 0 1.03-.453 1.03-1.012v-4.061l2-1.442v6.002c0 1.397-1.2 2.501-2.62 2.501H7.574C6.153 19.85 5 18.717 5 17.32V8.35c0-1.397 1.16-2.502 2.58-2.502z"></path></svg>写文章</button><div class="Popover"><button title="更多" type="button" id="null-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="null-content" class="Button ColumnPageHeader-MenuToggler Button--plain"><svg class="Zi Zi--Dots" fill="currentColor" viewBox="0 0 24 24" width="24" height="24"><path d="M5 14a2 2 0 1 1 0-4 2 2 0 0 1 0 4zm7 0a2 2 0 1 1 0-4 2 2 0 0 1 0 4zm7 0a2 2 0 1 1 0-4 2 2 0 0 1 0 4z" fill-rule="evenodd"></path></svg></button></div></div></div></div></div></div><img class="TitleImage" src="https://pic4.zhimg.com/v2-260c5a5d732d69d7378ffdf01403b92e_1200x500.jpg" alt="高观点下的Julia泛用编程"/><article class="Post-Main Post-NormalMain" tabindex="-1"><header class="Post-Header"><h1 class="Post-Title">高观点下的Julia泛用编程</h1><div class="Post-Author"><div class="AuthorInfo" itemProp="author" itemscope="" itemType="http://schema.org/Person"><meta itemProp="name" content="平平淡淡红美铃"/><meta itemProp="image" content="https://pic4.zhimg.com/da8e974dc_l.jpg"/><meta itemProp="url" content="https://www.zhihu.com/people/zhao-wang-hong-xuan"/><meta itemProp="zhihu:followerCount"/><span class="UserLink AuthorInfo-avatarWrapper"><div class="Popover"><div id="null-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="null-content"><a class="UserLink-link" data-za-detail-view-element_name="User" target="_blank" href="//www.zhihu.com/people/zhao-wang-hong-xuan"><img class="Avatar Avatar--round AuthorInfo-avatar" width="38" height="38" src="https://pic4.zhimg.com/da8e974dc_xs.jpg" srcSet="https://pic4.zhimg.com/da8e974dc_l.jpg 2x" alt="平平淡淡红美铃"/></a></div></div></span><div class="AuthorInfo-content"><div class="AuthorInfo-head"><span class="UserLink AuthorInfo-name"><div class="Popover"><div id="null-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="null-content"><a class="UserLink-link" data-za-detail-view-element_name="User" target="_blank" href="//www.zhihu.com/people/zhao-wang-hong-xuan">平平淡淡红美铃</a></div></div></span></div><div class="AuthorInfo-detail"><div class="AuthorInfo-badge"><div class="ztext AuthorInfo-badgeText">编程, 编程语言等话题差劲回答者。</div></div></div></div></div></div><div><span class="Voters"><button type="button" class="Button Button--plain">67 人<!-- -->赞同了该文章</button></span></div></header><div class="Post-RichTextContainer"><div class="RichText ztext Post-RichText"><p>高观点下的Julia范用编程</p><p><a href="https://link.zhihu.com/?target=https%3A//julialang.org/" class=" wrap external" target="_blank" rel="nofollow noreferrer">Julia</a>是一个支持可选类型标注的纯动态多范式语言。</p><p>由于其引入的一些像For循环，While循环, If循环, 函数等的基本语言构造, 与Python, R或是MATLAB类似, Julia变得简单和简洁, 使得你可以仅用它一部分的语言特性便流畅地工作。</p><p class="ztext-empty-paragraph"><br/></p><figure data-size="normal"><noscript><img src="https://pic4.zhimg.com/v2-4f7e4549d9a6e8778cdef24b098981ef_b.jpg" data-rawwidth="757" data-rawheight="909" data-size="normal" data-caption="" class="origin_image zh-lightbox-thumb" width="757" data-original="https://pic4.zhimg.com/v2-4f7e4549d9a6e8778cdef24b098981ef_r.jpg"/></noscript><img src="data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;757&#39; height=&#39;909&#39;&gt;&lt;/svg&gt;" data-rawwidth="757" data-rawheight="909" data-size="normal" data-caption="" class="origin_image zh-lightbox-thumb lazy" width="757" data-original="https://pic4.zhimg.com/v2-4f7e4549d9a6e8778cdef24b098981ef_r.jpg" data-actualsrc="https://pic4.zhimg.com/v2-4f7e4549d9a6e8778cdef24b098981ef_b.jpg"/></figure><p>尽管人们很少关注Julia除开高性能以外的语言特性(截止2019年4月)，我的角度却是在它的泛用编程方面。</p><h2>First-Class</h2><p>Julia中, 几乎所有的语言构造都是<b>first-class</b>的，使得语言的灵活性和可组合性得以彰显。</p><p>很多人对于Python缺少多行lambda这事抱有偏见。尽管把多行lambda编译到通常的Python code object是相当平凡和直接的, 前端，更具体点，强制缩进，通过严格分离表达式和语句(语句无法出现在表达式中), 限制了Python的表达力, 也失去了 first-class。其他的没有限制expression-first的语言缩进方式是有的，例如ML家族和Haskell, 但还没有被Python社区所采纳。</p><p>Julia看起来有点过于first-class, 因为它所有的构造都是表达式, 在语法上讲并不限制任意语言构造的组合。<b>定义</b>和<b>计算</b>在很多主流的函数式语言中是分离的，只是两者的组成里各自包含对方。</p><div class="highlight"><pre><code class="language-julia"><span class="p">[</span><span class="k">let</span> <span class="n">y</span><span class="o">=</span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">);</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="k">end</span> <span class="k">for</span> <span class="n">x</span> <span class="kp">in</span> <span class="n">points</span><span class="p">]</span>
<span class="n">map</span><span class="p">(</span>
    <span class="k">function</span> <span class="n">map_fn</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="c"># 做一些事情</span>
    <span class="k">end</span><span class="p">,</span>
    <span class="n">points</span>
<span class="p">)</span>

<span class="k">let</span> <span class="n">bind_maybe</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">a</span> <span class="o">==</span> <span class="nb">nothing</span> <span class="o">?</span> <span class="n">f</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">:</span> <span class="nb">nothing</span><span class="p">,</span>
    <span class="p">(</span><span class="o">|&gt;</span><span class="p">)</span> <span class="o">=</span> <span class="n">bind_maybe</span>

    <span class="n">init</span>          <span class="o">|&gt;</span> <span class="n">a</span> <span class="o">-&gt;</span>
    <span class="n">do1_stuffs</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">|&gt;</span> <span class="n">a</span> <span class="o">-&gt;</span>
    <span class="o">...</span>           <span class="o">|&gt;</span> <span class="n">a</span> <span class="o">-&gt;</span>
    <span class="o">...</span>           <span class="o">|&gt;</span> <span class="n">a</span> <span class="o">-&gt;</span>
    <span class="o">...</span>
<span class="k">end</span></code></pre></div><p>为什么可组合性很关键的原因多年来被经常讨论，所以我不会就此再整一个。 对于Julia而言，first-class在涉及<b>代码即数据</b>时会很有用, 文章稍后展开这点。</p><h2>多重分派的多态</h2><p>Julia支持多态，以实现必要的抽象，减少self-repeating，尽管和那些流行的工业语言有着明显的不同。</p><p>多重分派看起来有点像参数化多态, 但实际上其含义比起后者要多。</p><div class="highlight"><pre><code class="language-julia">  <span class="k">function</span> <span class="n">usum</span><span class="p">(</span><span class="n">x</span> <span class="o">::</span> <span class="kt">Vector</span><span class="p">{</span><span class="n">T</span><span class="p">})</span> <span class="n">where</span> <span class="n">T</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">zero</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">each</span> <span class="kp">in</span> <span class="n">x</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="n">each</span>
    <span class="k">end</span>
    <span class="n">s</span>
<span class="k">end</span></code></pre></div><p>重载也是可以的。</p><div class="highlight"><pre><code class="language-julia"><span class="n">uzero</span><span class="p">(</span><span class="n">_</span> <span class="o">::</span> <span class="kt">Type</span><span class="p">{</span><span class="kt">Int</span><span class="p">})</span>     <span class="o">=</span> <span class="mi">0</span>
<span class="n">uzero</span><span class="p">(</span>  <span class="o">::</span> <span class="kt">Type</span><span class="p">{</span><span class="kt">Float64</span><span class="p">})</span> <span class="o">=</span> <span class="mf">0.0</span></code></pre></div><p>然而多重分派不仅仅是我上面列举的。实际上类型只是可分派的不可变数据的一种特殊实例， 你能够用不可变的数据来分派，不管它是类型还是别的什么劳什子。</p><div class="highlight"><pre><code class="language-julia">   <span class="k">struct</span> <span class="n">Const</span><span class="p">{</span><span class="n">T</span><span class="p">}</span>
<span class="k">end</span>

<span class="n">flip</span><span class="p">(</span><span class="o">::</span><span class="kt">Type</span><span class="p">{</span><span class="n">Const</span><span class="p">{</span><span class="o">:</span><span class="n">even</span><span class="p">}})</span> <span class="o">=</span> <span class="n">Const</span><span class="p">{</span><span class="o">:</span><span class="n">odd</span><span class="p">}</span>
<span class="n">flip</span><span class="p">(</span><span class="o">::</span><span class="kt">Type</span><span class="p">{</span><span class="n">Const</span><span class="p">{</span><span class="o">:</span><span class="n">odd</span><span class="p">}})</span>  <span class="o">=</span> <span class="n">Const</span><span class="p">{</span><span class="o">:</span><span class="n">even</span><span class="p">}</span>

<span class="n">f</span><span class="p">(</span><span class="o">::</span><span class="kt">Type</span><span class="p">{</span><span class="n">Const</span><span class="p">{</span><span class="mi">0</span><span class="p">}})</span> <span class="o">=</span> <span class="n">Const</span><span class="p">{</span><span class="o">:</span><span class="n">even</span><span class="p">}</span>
<span class="n">f</span><span class="p">(</span><span class="o">::</span><span class="kt">Type</span><span class="p">{</span><span class="n">Const</span><span class="p">{</span><span class="mi">1</span><span class="p">}})</span> <span class="o">=</span> <span class="n">Const</span><span class="p">{</span><span class="o">:</span><span class="n">odd</span><span class="p">}</span>
<span class="n">f</span><span class="p">(</span><span class="o">::</span><span class="kt">Type</span><span class="p">{</span><span class="n">Const</span><span class="p">{</span><span class="n">N</span><span class="p">}})</span> <span class="n">where</span> <span class="n">N</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">Const</span><span class="p">{</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">})</span> <span class="o">|&gt;</span> <span class="n">flip</span></code></pre></div><p>使用上述代码，我们可以如期地静态计算数字的奇偶性。</p><div class="highlight"><pre><code class="language-julia">   <span class="n">julia</span><span class="o">&gt;</span> <span class="nd">@code_warntype</span> <span class="n">f</span><span class="p">(</span><span class="n">Const</span><span class="p">{</span><span class="mi">2</span><span class="p">})</span>

<span class="n">Body</span><span class="o">::</span><span class="kt">Type</span><span class="p">{</span><span class="n">Const</span><span class="p">{</span><span class="o">:</span><span class="n">even</span><span class="p">}}</span>
    <span class="mi">1</span> <span class="n">─</span>     <span class="k">return</span> <span class="n">Const</span><span class="p">{</span><span class="o">:</span><span class="n">even</span><span class="p">}</span></code></pre></div><p>注意，如果多重分派在静态推断上失败，它将表现得如同Python中的动态分派一般。</p><h2>Full-Featured的宏</h2><p>宏是实现代码复用的极少途径之一, 也是为什么有一些程序员千百倍高效于其他人的原因。</p><div class="highlight"><pre><code class="language-julia">  <span class="n">julia</span><span class="o">&gt;</span> <span class="k">macro</span> <span class="n">gen_var</span><span class="p">(</span><span class="n">n</span> <span class="o">::</span> <span class="kt">Int</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
        <span class="n">defs</span> <span class="o">=</span> <span class="p">[</span><span class="kt">Expr</span><span class="p">(</span><span class="o">:</span><span class="p">(</span><span class="o">=</span><span class="p">),</span> <span class="kt">Symbol</span><span class="p">(</span><span class="s">&#34;var&#34;</span><span class="p">,</span> <span class="n">i</span><span class="p">),</span> <span class="o">:</span><span class="p">(</span><span class="o">$</span><span class="n">f</span><span class="p">(</span><span class="o">$</span><span class="n">i</span><span class="p">)))</span>  <span class="k">for</span> <span class="n">i</span> <span class="kp">in</span> <span class="mi">1</span><span class="o">:</span><span class="n">n</span><span class="p">]</span>
        <span class="n">esc</span><span class="p">(</span><span class="kt">Expr</span><span class="p">(</span><span class="o">:</span><span class="n">block</span><span class="p">,</span>  <span class="n">defs</span><span class="o">...</span><span class="p">,</span> <span class="nb">nothing</span><span class="p">))</span>
    <span class="k">end</span>

<span class="nd">@gen_var</span> <span class="p">(</span><span class="k">macro</span> <span class="n">with</span> <span class="mi">1</span> <span class="n">method</span><span class="p">)</span>

<span class="n">julia</span><span class="o">&gt;</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">-</span> <span class="mi">2</span>
<span class="n">f</span> <span class="p">(</span><span class="n">generic</span> <span class="k">function</span> <span class="n">with</span> <span class="mi">1</span> <span class="n">method</span><span class="p">)</span>

<span class="n">julia</span><span class="o">&gt;</span> <span class="nd">@gen_var</span> <span class="n">f</span> <span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span>

<span class="n">julia</span><span class="o">&gt;</span> <span class="n">var1</span>
<span class="mi">8</span>

<span class="n">julia</span><span class="o">&gt;</span> <span class="n">var2</span>
<span class="mi">18</span></code></pre></div><h2>宏，从AST到AST的函数</h2><p>一旦你知道宏是从AST到AST的函数后，Julia的宏便不再神秘。</p><div class="highlight"><pre><code class="language-julia">   <span class="k">macro</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">println</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="o">:</span><span class="p">(</span><span class="o">$</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="k">end</span>

<span class="nd">@assert</span> <span class="p">(</span><span class="nd">@f</span> <span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span></code></pre></div><p>上述代码展示了Julia宏的一个生动例子。首先 <code>macro</code> 关键字引导宏变换规则的定义，而<code>@f</code>标记来对应宏规则的调用点。</p><p>你可能会问为什么<code>(@f 1 == 2</code>, 因为宏<code>@f</code>的返回值是一个AST，看起来让它和整数<code>2</code>相等有点魔幻。</p><p>认真看<code>@assert (@f 1) == 2</code>。由于宏调用是从内到外依次处理的，我们首先处理的应该是<code>@f 1</code>。</p><div class="highlight"><pre><code class="language-julia"><span class="p">(</span><span class="k">function</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">println</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="o">:</span><span class="p">(</span><span class="o">$</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>         <span class="o">=&gt;</span>  <span class="o">:</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="k">end</span><span class="p">)(</span><span class="mi">1</span><span class="p">)</span></code></pre></div><p>上面这步，在执行AST到AST的函数<code>f</code>, 即宏<code>@f</code>, 的时候，还会写stdio.</p><p>随后，由于我们已经拿到一个输出, AST <code>:(1 + 1)</code>, 设想我们用它置换先前代码中的<code>@f 1</code>，这会产生一个<code>@assert $(:(1 + 1)) == 2</code>, 化简它，然后我们得到<code>@assert (1 + 1) == 2</code>。</p><p>你可能会问为什么<code>@assert :(1 + 1) == 2</code>, 好问题，我们深入研究一个。</p><p>想想如果你从宏调用处返回的是一个运行时AST，它不会被转换为要编译的代码，以至于这样的宏会变得完全没有用。</p><p>如果我们<i>unquote</i>宏的返回，</p><figure data-size="normal"><noscript><img src="https://pic3.zhimg.com/v2-ddd869022dcf1dfae3942de0ffcf4a76_b.jpg" data-rawwidth="868" data-rawheight="314" data-size="normal" data-caption="" class="origin_image zh-lightbox-thumb" width="868" data-original="https://pic3.zhimg.com/v2-ddd869022dcf1dfae3942de0ffcf4a76_r.jpg"/></noscript><img src="data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;868&#39; height=&#39;314&#39;&gt;&lt;/svg&gt;" data-rawwidth="868" data-rawheight="314" data-size="normal" data-caption="" class="origin_image zh-lightbox-thumb lazy" width="868" data-original="https://pic3.zhimg.com/v2-ddd869022dcf1dfae3942de0ffcf4a76_r.jpg" data-actualsrc="https://pic3.zhimg.com/v2-ddd869022dcf1dfae3942de0ffcf4a76_b.jpg"/></figure><p class="ztext-empty-paragraph"><br/></p><p>上面的表格揭示了AST插值的规则，以及，很明显这里有点东西: 如果我们说一个表达式被quote了N次，那么它的插值，作为一个表达式被quote了<code>max(0, N - 1)</code>次。</p><h2>作用域和卫生</h2><p>只要你站在宏是AST到AST的函数这个观点下， 宏(返回的AST)的作用域规则会很简单。</p><div class="highlight"><pre><code class="language-julia">  <span class="n">julia</span><span class="o">&gt;</span> <span class="k">module</span> <span class="n">A</span>
    <span class="n">var</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">macro</span> <span class="n">ma</span><span class="p">()</span>
    <span class="k">quote</span>
        <span class="n">var</span>
    <span class="k">end</span>
    <span class="k">end</span>
<span class="k">end</span>

<span class="n">julia</span><span class="o">&gt;</span> <span class="n">var</span> <span class="o">=</span> <span class="mi">5555</span>

<span class="n">julia</span><span class="o">&gt;</span> <span class="n">A</span><span class="o">.</span><span class="nd">@ma</span>
<span class="mi">0</span>

<span class="n">julia</span><span class="o">&gt;</span> <span class="k">using</span> <span class="o">.</span><span class="n">A</span><span class="o">:</span> <span class="nd">@ma</span>

<span class="n">julia</span><span class="o">&gt;</span> <span class="nd">@ma</span>
<span class="mi">0</span></code></pre></div><p>我这儿要说的第一点是, 宏返回的表达式是在宏定义处的模块被求值的。</p><div class="highlight"><pre><code class="language-julia">  <span class="k">macro</span> <span class="n">assign_y</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="o">:</span><span class="p">(</span><span class="n">y</span> <span class="o">=</span> <span class="o">$</span><span class="n">x</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">function</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="nd">@assign_y</span> <span class="n">x</span>
    <span class="n">y</span>
<span class="k">end</span>

<span class="n">f</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span></code></pre></div><p>你可能期望这代码能预期跑通，但很不幸，不行，只会给你扔一个</p><div class="highlight"><pre><code class="language-julia"><span class="n">ERROR</span><span class="o">:</span> <span class="kt">UndefVarError</span><span class="o">:</span> <span class="n">x</span> <span class="n">not</span> <span class="n">defined</span>
<span class="n">Stacktrace</span><span class="o">:</span>
<span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="n">f</span><span class="p">(</span><span class="o">::</span><span class="kt">Int64</span><span class="p">)</span> <span class="n">at</span> <span class="o">./</span><span class="n">REPL</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">:</span><span class="mi">2</span>
<span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="n">top</span><span class="o">-</span><span class="n">level</span> <span class="n">scope</span> <span class="n">at</span> <span class="n">none</span><span class="o">:</span><span class="mi">0</span></code></pre></div><p>这里的原因是，AST插值会被预先处理，以确保所有的裸符号(没有包在<code>QuoteNode</code>和更深的quote中)会被 转换到像<code>##a#168</code>这样有点奇怪的<b>mangled</b>符号(也被称为<i>gensym</i>). 同时，Julia干这事儿的原因， 是为了默认避免为局部作用域产生新的可见符号。</p><p>想想你想打算在计算了值后进行打印的宏:</p><div class="highlight"><pre><code class="language-julia">   <span class="k">macro</span> <span class="n">with_logging</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>
    <span class="k">quote</span>
        <span class="n">a</span> <span class="o">=</span> <span class="o">$</span><span class="n">expr</span>
        <span class="nd">@info</span> <span class="o">:</span><span class="n">logging</span> <span class="n">a</span>
        <span class="n">a</span>
    <span class="k">end</span>
<span class="k">end</span></code></pre></div><p>我们没把符号<code>a</code>转换到类似<code>##a#167</code>这样子，假如你已经在你的代码里定义了<code>a</code>呢?</p><div class="highlight"><pre><code class="language-julia">  <span class="k">function</span> <span class="n">x5</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="c"># 把它当作乘5</span>
    <span class="n">x2</span> <span class="o">=</span> <span class="nd">@with_logging</span> <span class="mi">2</span><span class="n">a</span>
    <span class="n">x3</span> <span class="o">=</span> <span class="nd">@with_logging</span> <span class="mi">3</span><span class="n">a</span>
    <span class="n">x2</span> <span class="o">+</span> <span class="n">x3</span>
<span class="k">end</span>

<span class="n">my_func</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span></code></pre></div><p>你可以看见如果宏<code>with_logging</code>不转换宏定义体里写的<code>a</code>, 你将会得到<code>x5(1) == 8</code>而不是<code>x5(1) == 5</code>。</p><p>就是这样，我们叫这样的宏，<b>卫生宏</b>。</p><p>但是还有一些上下文有关的代码生成，你想要在多个代码生成函数中共享作用域。一个有点东西的例子是 我的MLStyle, 它实现了我自学习编程以来的一个梦想，即能够使用一个高性能且可扩展(可自定义)的模式匹配。 在这个包里，在编译模式的时候，我会使用手动的gensym而不是依靠卫生宏，因为我可能在不同的会生成代码的函数里 访问某些指定的符号。</p><p>在这种情况下，人们想要产生可以污染作用域的符号，Julia提供来一种转义(escaped)机制来避免gensym.</p><div class="highlight"><pre><code class="language-julia">  <span class="k">macro</span> <span class="n">assign_y</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">esc</span><span class="p">(</span><span class="o">:</span><span class="p">(</span><span class="n">y</span> <span class="o">=</span> <span class="o">$</span><span class="n">x</span><span class="p">))</span>
<span class="k">end</span>

<span class="k">function</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="nd">@assign_y</span> <span class="n">x</span>
    <span class="n">y</span>
<span class="k">end</span>

<span class="n">f</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c"># 1</span></code></pre></div><p>先前的代码, 在返回的AST上补充了一个<code>esc</code>的调用后，便可以正常工作。</p><h2>其他对Julia宏有用的知识点</h2><ol><li><code>@__MODULE__</code>会给当前模块。</li><li>当你想要控制求值(evaluate) AST的模块时，你可以用<code>moduleX.eval(expr)</code> 或者 <code>@eval moduleX expr</code>。</li><li>尽管我们已经知道宏是函数，一些需要强调的事情是，这里有两个隐式的参数: <code>__module__</code> 和 <code>__source__</code>, <code>__module__</code>    是你调用该宏时所处的模块，<code>__source__</code>是该宏调用的行号结点。</li></ol><h2>AST操作上的进步</h2><p>Julia在AST上搞得很多，比如，分析，替换，重写，诸如此类。</p><p>由于我们已经介绍来AST的插值规则，你可能已经知道我们能像下面代码那样产生AST，而不是用纯粹的构造性的方式。</p><div class="highlight"><pre><code class="language-julia">  <span class="n">ex0</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="n">ex1</span> <span class="o">=</span> <span class="o">:</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>

<span class="n">ex2</span> <span class="o">=</span> <span class="o">:</span><span class="p">(</span><span class="o">$</span><span class="n">ex0</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="c"># :([1, 2, 3] + 1), [1, 2, 3] here is already evaluated before interpolation.</span>

<span class="n">ex3</span> <span class="o">=</span> <span class="o">:</span><span class="p">(</span><span class="o">$</span><span class="n">ex1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="c"># :([1, 2, 3] + 1)</span></code></pre></div><p>这不是那么酷炫，因为现阶段其他的语言也有接近这样的支持。</p><p>进步在于对于AST的解构, 这极大地影响了我们可以用来分析AST的方式。</p><p>考虑这样一种情况，你想要从函数调用处搜集所有的位置参数和关键字参数。</p><div class="highlight"><pre><code class="language-julia">  <span class="n">get_arg_info</span><span class="p">(</span><span class="o">:</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)))</span> <span class="c"># =&gt; ([:a, :b, :(c = 1)], [:(b = 2)])</span>
<span class="n">get_arg_info</span><span class="p">(</span><span class="o">:</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">args</span><span class="o">...</span><span class="p">;</span> <span class="n">kwargs</span><span class="o">...</span><span class="p">)))</span> <span class="c"># =&gt; ([:(args...)], [:(kwargs...)])</span>
<span class="n">get_arg_info</span><span class="p">(</span><span class="o">:</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">)))</span>            <span class="c"># =&gt; ([:a, :b, :c], [])</span></code></pre></div><p>你会如何干这事？</p><p>注意！无论你打算如何处理它，想想你是否需要对Julia的AST有一个预先的了解? 比方说，你不得不知道 <code>Expr</code>(正是Julia AST的类型中最为重要的一种)有两个fields, <code>head</code>和<code>args</code>， 或者你不得不理解 <code>a.b</code>的结构是</p><div class="highlight"><pre><code class="language-julia">  <span class="kt">Expr</span>
<span class="n">head</span><span class="o">:</span> <span class="kt">Symbol</span> <span class="o">.</span>
<span class="n">args</span><span class="o">:</span> <span class="kt">Array</span><span class="p">{</span><span class="kt">Any</span><span class="p">}((</span><span class="mi">2</span><span class="p">,))</span>
    <span class="mi">1</span><span class="o">:</span> <span class="kt">Symbol</span> <span class="n">a</span>
    <span class="mi">2</span><span class="o">:</span> <span class="kt">QuoteNode</span>
    <span class="n">value</span><span class="o">:</span> <span class="kt">Symbol</span> <span class="n">b</span></code></pre></div><p>而非</p><div class="highlight"><pre><code class="language-julia">  <span class="kt">Expr</span>
<span class="n">head</span><span class="o">:</span> <span class="kt">Symbol</span> <span class="o">.</span>
<span class="n">args</span><span class="o">:</span> <span class="kt">Array</span><span class="p">{</span><span class="kt">Any</span><span class="p">}((</span><span class="mi">2</span><span class="p">,))</span>
    <span class="mi">1</span><span class="o">:</span> <span class="kt">Symbol</span> <span class="n">a</span>
    <span class="mi">2</span><span class="o">:</span> <span class="kt">Symbol</span> <span class="n">b</span></code></pre></div><p>或者你不得不搞清楚，对于向量的字面量，有</p><figure data-size="normal"><noscript><img src="https://pic3.zhimg.com/v2-d354dcdc6ae02c7bc2fcef5bb496a44a_b.jpg" data-rawwidth="874" data-rawheight="828" data-size="normal" data-caption="" class="origin_image zh-lightbox-thumb" width="874" data-original="https://pic3.zhimg.com/v2-d354dcdc6ae02c7bc2fcef5bb496a44a_r.jpg"/></noscript><img src="data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;874&#39; height=&#39;828&#39;&gt;&lt;/svg&gt;" data-rawwidth="874" data-rawheight="828" data-size="normal" data-caption="" class="origin_image zh-lightbox-thumb lazy" width="874" data-original="https://pic3.zhimg.com/v2-d354dcdc6ae02c7bc2fcef5bb496a44a_r.jpg" data-actualsrc="https://pic3.zhimg.com/v2-d354dcdc6ae02c7bc2fcef5bb496a44a_b.jpg"/></figure><p class="ztext-empty-paragraph"><br/></p><p>说实在的，这里有这么多的关于结构的细节问题，但是当你需要使用 Julia AST工作(包括对结构的分析)时，你真的有必要知晓所有东西吗？</p><p>不!当然是不用的!尽管我知道, 你们中一些时间更长的Julia使用者, 总是通过你们 丰富的Julia internal知识来检查以及分解AST，但我真诚地建议你开始使用MLStyle.jl, 为了你的效率起见。</p><p>在此，我会介绍<a href="https://link.zhihu.com/?target=https%3A//thautwarm.github.io/MLStyle.jl/latest" class=" wrap external" target="_blank" rel="nofollow noreferrer">MLStyle的AST操作</a> 来给你一些有印象深刻的例子。 当然，这个包会在某一天被更好的替代，但其本质的方法论不会偏离分毫。现在不要马上打开链接，跟着我的介绍走，你不需要 对一个具体的包或者框架过分在意，除了它的核心思想。</p><p>一个重要的灵感在2018年的某一天降临了我: 假如我们可以<b>用构造AST的方式去解构AST</b>，会怎么样？</p><p>实际上，你并不需要精确地知道所有AST的结构，在你开始写它对应的语法的时候。比如你可以写</p><div class="highlight"><pre><code class="language-julia">  <span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="n">b</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">]</span>
<span class="n">c</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">;</span> <span class="mi">2</span><span class="p">;</span> <span class="mi">3</span><span class="p">]</span>
<span class="n">d</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span><span class="p">;</span> <span class="mi">3</span> <span class="mi">4</span><span class="p">]</span></code></pre></div><p>你需要知道他们的AST长什么样吗？不用的。</p><p>我有个仅仅学数学，此前从来不接触编程的同学, 也可以流畅地写出这样的代码来解决他的线性代数作业, 但当我尝试跟他讲AST的概念, 以及他刚写的代码的AST长什么样时，他感觉非常恼火。</p><p>你或许已经注意到了使用语法要素的重要性。是的，在像数据一样处理代码的方面，它将 取得巨大的进步。</p><p><a href="https://link.zhihu.com/?target=https%3A//en.wikipedia.org/wiki/Pattern_matching" class=" wrap external" target="_blank" rel="nofollow noreferrer">模式匹配</a>是现代函数式语言中的一个基本设施， 通过<b>像构造数据一样进行解构</b>, 它能够降低处理几乎所有逻辑时的复杂性。</p><p>好的，这句话出现两次了:</p><p><b>像构造数据一样进行解构</b>.</p><p>记住它，它是我们这一节的根本准则。</p><p>让我们想想AST是怎么被构造的?</p><p>首先，我们可以写生(类似生开水的生)的AST，字面地写它。</p><div class="highlight"><pre><code class="language-julia"><span class="n">ex</span> <span class="o">=</span> <span class="o">:</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">ex</span> <span class="o">=</span> <span class="o">:</span><span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">]</span></code></pre></div><p>然后，我们有AST插值。</p><div class="highlight"><pre><code class="language-julia"><span class="n">ex</span> <span class="o">=</span> <span class="o">:</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="n">ex</span> <span class="o">=</span> <span class="o">:</span><span class="p">(</span><span class="o">$</span><span class="n">ex</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="c"># :([1, 2, 3] + 1)</span></code></pre></div><p>这就够了。现在让我们介绍<code>@match</code>. 这个语法可能会在你的时间点下被更好的类似物替代， 但利用你读这篇文章时最好的模式匹配库， 你必然可以轻易地实现等价乃至更好的东西。</p><div class="highlight"><pre><code class="language-julia">  <span class="nd">@match</span> <span class="n">value</span> <span class="k">begin</span>
    <span class="n">pattern1</span> <span class="o">=&gt;</span> <span class="n">value1</span>
    <span class="n">pattern2</span> <span class="o">=&gt;</span> <span class="n">value2</span>
<span class="k">end</span></code></pre></div><p>为了支持匹配字面量AST， 我们必须要求下列代码返回<code>true</code>.</p><div class="highlight"><pre><code class="language-julia">  <span class="c"># rmlines is a function that removes all line number nodes in an AST.</span>
<span class="c"># you can fetch it here : https://github.com/thautwarm/MLStyle.jl#preview</span>

<span class="nd">@match</span> <span class="n">rmlines</span><span class="p">(</span><span class="o">:</span><span class="p">(</span><span class="k">let</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">x</span> <span class="k">end</span><span class="p">))</span> <span class="k">begin</span>
    <span class="o">:</span><span class="p">(</span><span class="k">let</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">x</span> <span class="k">end</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="kc">true</span>
    <span class="n">_</span> <span class="o">=&gt;</span> <span class="kc">false</span>
<span class="k">end</span></code></pre></div><p>想想我们已经建立其的那个根本准则, 好吧，我又会重复它一遍因为我是个 劣质的复读机:</p><p><b>像构造数据一样进行解构</b>.</p><p>然后</p><div class="highlight"><pre><code class="language-julia">  <span class="n">v</span> <span class="o">=</span> <span class="o">:</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="n">ex</span> <span class="o">=</span> <span class="o">:</span><span class="p">(</span><span class="o">$</span><span class="n">v</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="nd">@match</span> <span class="n">ex</span> <span class="k">begin</span>
    <span class="o">:</span><span class="p">(</span><span class="o">$</span><span class="n">v</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">v</span> <span class="o">==</span> <span class="o">:</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="n">_</span> <span class="o">=&gt;</span> <span class="kc">false</span>
<span class="k">end</span></code></pre></div><p>嗷! 你懂吗? 你感觉这个有点东西吗?</p><p>AST插值对应着构造，那么出现在模式中的AST插值就表示解构。我们可以把它叫做&#34;AST摘要&#34;。</p><p>现在，然后我们回到最开始的问题，实现之前提到的<code>get_arg_info</code>。</p><p>首先， 我们用一些例子来介绍<code>get_arg_info</code>情形下的构造。</p><div class="highlight"><pre><code class="language-julia">  <span class="n">f</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">;</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="o">+</span> <span class="n">c</span> <span class="o">+</span> <span class="n">d</span>
<span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<span class="n">kwargs</span> <span class="o">=</span> <span class="kt">Dict</span><span class="p">(</span><span class="o">:</span><span class="n">c</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="o">:</span><span class="n">d</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">f</span><span class="p">(</span><span class="n">args</span><span class="o">...</span> <span class="p">;</span> <span class="n">kwargs</span><span class="o">...</span><span class="p">)</span></code></pre></div><p>这会给出结果六。</p><p>注意形式<code>f(args...; kwargs...)</code>, 这貌似表示，在AST层面上，位置参数和关键字参数都是用数组来存的。</p><p>试试:</p><div class="highlight"><pre><code class="language-julia">  <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="o">:</span><span class="n">a</span><span class="p">,</span> <span class="o">:</span><span class="n">b</span><span class="p">]</span>
<span class="o">:</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="o">$</span><span class="p">(</span><span class="n">args</span><span class="o">...</span><span class="p">)))</span></code></pre></div><p>然后你能够拿到一个输出，恰好是</p><div class="highlight"><pre><code class="language-text">:(f(a, b))</code></pre></div><p>很好，好极了。现在我们再用MLStyle的<code>@match</code>, 还是遵守<b>像构造数据一样进行解构</b>的规矩。</p><div class="highlight"><pre><code class="language-julia">    <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="o">:</span><span class="n">a</span><span class="p">,</span> <span class="o">:</span><span class="n">b</span><span class="p">]</span>
    <span class="nd">@match</span> <span class="o">:</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="o">$</span><span class="p">(</span><span class="n">args</span><span class="o">...</span><span class="p">)))</span> <span class="k">begin</span>
        <span class="o">:</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="o">$</span><span class="p">(</span><span class="n">args</span><span class="o">...</span><span class="p">)))</span> <span class="o">=&gt;</span> <span class="n">args</span> <span class="o">==</span> <span class="p">[</span><span class="o">:</span><span class="n">a</span><span class="p">,</span> <span class="o">:</span><span class="n">b</span><span class="p">]</span>
        <span class="n">_</span> <span class="o">=&gt;</span> <span class="kc">false</span>
    <span class="k">end</span></code></pre></div><p>然后你拿到一个<code>true</code>的输出。</p><p>要多想。然后看看<code>get_arg_info</code>的最终实现:</p><div class="highlight"><pre><code class="language-julia">    <span class="n">get_arg_info</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span> <span class="o">=</span> <span class="nd">@match</span> <span class="n">ex</span> <span class="k">begin</span>
        <span class="o">:</span><span class="p">(</span><span class="o">$</span><span class="n">name</span><span class="p">(</span><span class="o">$</span><span class="p">(</span><span class="n">args</span><span class="o">...</span><span class="p">);</span> <span class="o">$</span><span class="p">(</span><span class="n">kwargs</span><span class="o">...</span><span class="p">)))</span> <span class="o">||</span>
        <span class="o">:</span><span class="p">(</span><span class="o">$</span><span class="n">name</span><span class="p">(</span><span class="o">$</span><span class="p">(</span><span class="n">args</span><span class="o">...</span><span class="p">)))</span> <span class="o">&amp;&amp;</span> <span class="n">Do</span><span class="p">(</span><span class="n">kwargs</span> <span class="o">=</span> <span class="p">[])</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>

        <span class="n">_</span> <span class="o">=&gt;</span> <span class="n">throw</span><span class="p">(</span><span class="s">&#34;invalid input&#34;</span><span class="p">)</span>
    <span class="k">end</span></code></pre></div><p><code>||</code> 表示所谓的Or模式(or-pattern)。</p><h2>缺憾: 函数类型的缺失</h2><p>Julia对很多领域来说是一门理想的语言，但，不是所有。</p><p>对那些习惯函数式语言的人，尤其对那种倾向于使用基于类型的高级多态(type class的实现resolve, 隐式类型变量, 高阶类型抽象等), 专门的函数类型是一种基本到不能再基本的东西。</p><p>断断续续地，我和朋友做了很多尝试，来模拟那些高级的类型多态。但最终我们发现没有隐式推导，仅仅是 动态类型和多重分派还差得很远。</p><p>在Julia里，每一个函数都有它自己的类型，并且是<code>Function</code>的子类型，阻止来我们在类型层面去抽象函数们的公共 行为。更糟糕的是，这些类型层面对函数的抽象，已经被学界在一万年前证明是无处不在且极为有用的了，还扮演着 一个像是我们学习过程中四则运算一般的角色。</p><p>在Haskell中，函数的signature会对语义起作用。</p><p>下面的Haskell代码允许用户对给定的类型，通过这些类型上的性质/特质，来自动生成测试。</p><div class="highlight"><pre><code class="language-haskell">  <span class="kr">import</span> <span class="nn">Control.Arrow</span>
<span class="kr">import</span> <span class="nn">Data.Kind</span>

<span class="kr">newtype</span> <span class="kt">MkTest</span> <span class="p">(</span><span class="nf">c</span> <span class="ow">::</span> <span class="o">*</span> <span class="ow">-&gt;</span> <span class="kt">Constraint</span><span class="p">)</span> <span class="nf">a</span> <span class="ow">=</span> <span class="kt">MkTest</span> <span class="p">{</span><span class="nf">runTest</span> <span class="ow">::</span> <span class="nf">a</span><span class="p">}</span>

<span class="kr">class</span> <span class="kt">TestCase</span> <span class="p">(</span><span class="nf">c</span> <span class="ow">::</span> <span class="o">*</span> <span class="ow">-&gt;</span> <span class="kt">Constraint</span><span class="p">)</span> <span class="nf">a</span> <span class="kr">where</span>
    <span class="nf">samples</span>      <span class="ow">::</span> <span class="nf">c</span> <span class="nf">a</span> <span class="ow">=&gt;</span> <span class="kt">MkTest</span> <span class="nf">c</span> <span class="p">[</span><span class="nf">a</span><span class="p">]</span>
    <span class="nf">testWith</span>     <span class="ow">::</span> <span class="nf">c</span> <span class="nf">a</span> <span class="ow">=&gt;</span> <span class="p">(</span><span class="nf">a</span> <span class="ow">-&gt;</span> <span class="kt">Bool</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="kt">MkTest</span> <span class="nf">c</span> <span class="p">[(</span><span class="nf">a</span><span class="p">,</span> <span class="kt">Bool</span><span class="p">)]</span>
    <span class="nf">testWith</span> <span class="nf">logic</span> <span class="ow">=</span>
        <span class="kt">MkTest</span> <span class="o">$</span> <span class="nf">map</span> <span class="p">(</span><span class="nf">id</span> <span class="o">&amp;&amp;&amp;</span> <span class="nf">logic</span><span class="p">)</span> <span class="nf">seq</span>
        <span class="kr">where</span>
            <span class="nf">seq</span> <span class="ow">::</span> <span class="p">[</span><span class="nf">a</span><span class="p">]</span>
            <span class="nf">seq</span> <span class="ow">=</span> <span class="nf">runTest</span> <span class="p">(</span><span class="nf">samples</span> <span class="ow">::</span> <span class="kt">MkTest</span> <span class="nf">c</span> <span class="p">[</span><span class="nf">a</span><span class="p">])</span>

<span class="kr">type</span> <span class="kt">TestOn</span> <span class="nf">c</span> <span class="nf">a</span> <span class="ow">=</span> <span class="nf">c</span> <span class="nf">a</span> <span class="ow">=&gt;</span> <span class="p">(</span><span class="nf">a</span> <span class="ow">-&gt;</span> <span class="kt">Bool</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="kt">MkTest</span> <span class="nf">c</span> <span class="p">[(</span><span class="nf">a</span><span class="p">,</span> <span class="kt">Bool</span><span class="p">)]</span></code></pre></div><p>现在我会用Haskell代码来实现一个完美的可扩展的自动测试生成器， 通过下面的实例(Haskell中的术语)， 利用函数类型，来实现当前Julia(v1.1)中无法实现的多态。</p><div class="highlight"><pre><code class="language-haskell">  <span class="kr">instance</span> <span class="kt">TestCase</span> <span class="kt">Enum</span> <span class="nf">a</span> <span class="kr">where</span>
    <span class="nf">samples</span> <span class="ow">=</span> <span class="kt">MkTest</span> <span class="o">.</span> <span class="nf">enumFrom</span> <span class="o">.</span> <span class="nf">toEnum</span> <span class="o">$</span> <span class="mi">0</span>

<span class="kr">instance</span> <span class="kt">TestCase</span> <span class="kt">Bounded</span> <span class="nf">a</span> <span class="kr">where</span>
    <span class="nf">samples</span> <span class="ow">=</span> <span class="kt">MkTest</span> <span class="p">[</span><span class="nf">maxBound</span><span class="p">,</span> <span class="nf">minBound</span><span class="p">]</span></code></pre></div><p>现在我们为<code>TestCase</code>在约束(即Type Class)<code>Enum</code>和<code>Bounded</code>上创建实例。</p><p>对于不熟悉Haskell的读者来说，你可以把Haskell中的约束理解为(Rust中的)trait或者松耦合的interface。</p><p>一旦类型处于<code>Enum</code>的约束下，你就可以枚举它的取值, 以及<code>Bounded</code>是一种能够确保类型中最大和最小可以访问的约束(通过 <code>maxBound</code>和<code>minBound</code>)。<code>instance TestCase Enum a</code>表示对于所有的具体类型(非约束)<code>a</code>，为约束<code>TestCase</code>在约束<code>Enum</code> 和类型<code>a</code>上建立约束。是的， TestCase也是一种约束, 一个在其他约束和类型上建立约束的约束。</p><p>目前为止，我们的测试生成器已经搞定来，有点突然，对吧? 这就是Haskell: 务实, 生产力高效。</p><p>我们可以用上面的代码搞一些测试，利用我们数据类型的性质/特质。</p><div class="highlight"><pre><code class="language-haskell">  <span class="nf">onEnumerable</span> <span class="ow">::</span> <span class="kt">TestOn</span> <span class="kt">Enum</span> <span class="nf">a</span>
<span class="nf">onEnumerable</span> <span class="nf">logic</span> <span class="ow">=</span> <span class="nf">testWith</span> <span class="nf">logic</span>

<span class="nf">intTest</span> <span class="ow">::</span> <span class="kt">Int</span> <span class="ow">-&gt;</span> <span class="kt">Int</span>
<span class="nf">intTest</span> <span class="nf">x</span> <span class="ow">=</span> <span class="nf">x</span> <span class="o">^</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="nf">x</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">==</span> <span class="p">(</span><span class="nf">x</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span><span class="o">^</span><span class="mi">2</span>

<span class="nf">boolTest</span> <span class="ow">::</span> <span class="kt">Bool</span> <span class="ow">-&gt;</span> <span class="kt">Bool</span>
<span class="nf">boolTest</span> <span class="nf">x</span> <span class="ow">=</span> <span class="kt">True</span>

<span class="nf">main</span> <span class="ow">=</span> <span class="kr">do</span>
    <span class="nf">putStrLn</span> <span class="o">.</span> <span class="nf">show</span> <span class="o">.</span> <span class="nf">take</span> <span class="mi">10</span> <span class="o">.</span> <span class="nf">runTest</span> <span class="o">$</span> <span class="nf">onEnumerable</span> <span class="nf">intTest</span>
    <span class="nf">putStrLn</span> <span class="o">.</span> <span class="nf">show</span> <span class="o">.</span> <span class="nf">runTest</span> <span class="o">$</span> <span class="nf">onEnumerable</span> <span class="nf">boolTest</span>
    <span class="nf">return</span> <span class="nb">()</span></code></pre></div><p>这会输出</p><div class="highlight"><pre><code class="language-text">   [(0,True),(1,True),(2,True),(3,True),(4,True),(5,True),(6,True),(7,True),(8,True),(9,True)]
[(False, True), (True, True)]</code></pre></div><p>注意我在生成测试集上啥也没做，除了把说明测试逻辑的<code>intTest</code>和<code>boolTest</code>传过去。我只是 说了我想要测试他们的可枚举特质(<code>onEnumerable</code>), 然后多态的自动测试生成器利用函数signature (<code>intTest: Int -&gt; Bool</code>, <code>boolTest: Bool -&gt; Bool</code>), 然后一切搞定。</p><p>回到Julia侧，尽管Haskell做了很多隐式操作，多重分派总是可以成功地模拟它(但没有强类型和静态检查)。 问题在于函数类型的缺失，因为我们不能够利用它的类型信息参与分派。</p><p>下面的思路提供了一些暂时且不完整的解决方案:</p><div class="highlight"><pre><code class="language-julia">  <span class="k">import</span> <span class="n">Base</span><span class="o">:</span> <span class="n">convert</span>
<span class="k">struct</span> <span class="n">Fn</span><span class="p">{</span><span class="n">Arg</span><span class="p">,</span> <span class="n">Ret</span><span class="p">,</span> <span class="n">JlFuncType</span><span class="p">}</span>
    <span class="n">f</span> <span class="o">::</span> <span class="n">JlFuncType</span>
<span class="k">end</span>

<span class="nd">@inline</span> <span class="n">Fn</span><span class="p">{</span><span class="n">Arg</span><span class="p">,</span> <span class="n">Ret</span><span class="p">}(</span><span class="n">f</span> <span class="o">::</span> <span class="n">JlFuncType</span><span class="p">)</span> <span class="n">where</span> <span class="p">{</span><span class="n">Arg</span><span class="p">,</span> <span class="n">Ret</span><span class="p">,</span> <span class="n">JlFuncType</span><span class="p">}</span> <span class="o">=</span> <span class="n">Fn</span><span class="p">{</span><span class="n">Arg</span><span class="p">,</span> <span class="n">Ret</span><span class="p">,</span> <span class="n">JlFuncType</span><span class="p">}(</span><span class="n">f</span><span class="p">)</span>

<span class="nd">@generated</span> <span class="k">function</span> <span class="p">(</span><span class="n">f</span> <span class="o">::</span> <span class="n">Fn</span><span class="p">{</span><span class="n">Arg</span><span class="p">,</span> <span class="n">Ret</span><span class="p">,</span> <span class="n">JlFuncType</span><span class="p">})(</span><span class="n">a</span> <span class="o">::</span> <span class="n">Arg</span><span class="p">)</span> <span class="o">::</span> <span class="n">Ret</span> <span class="n">where</span> <span class="p">{</span><span class="n">Arg</span><span class="p">,</span> <span class="n">Ret</span><span class="p">,</span> <span class="n">JlFuncType</span><span class="p">}</span>
    <span class="k">quote</span>
        <span class="o">$</span><span class="p">(</span><span class="kt">Expr</span><span class="p">(</span><span class="o">:</span><span class="n">meta</span><span class="p">,</span> <span class="o">:</span><span class="n">inline</span><span class="p">))</span>
        <span class="n">f</span><span class="o">.</span><span class="n">f</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="k">end</span>
<span class="k">end</span>

<span class="n">convert</span><span class="p">(</span><span class="n">Fn</span><span class="p">{</span><span class="n">Arg</span><span class="p">,</span> <span class="n">Ret</span><span class="p">,</span> <span class="n">JlFuncType</span><span class="p">},</span> <span class="n">f</span> <span class="o">::</span> <span class="n">JlFuncType</span><span class="p">)</span> <span class="n">where</span> <span class="p">{</span><span class="n">Arg</span><span class="p">,</span> <span class="n">Ret</span><span class="p">,</span> <span class="n">JlFuncType</span><span class="p">}</span> <span class="o">=</span> <span class="n">Fn</span><span class="p">{</span><span class="n">Arg</span><span class="p">,</span> <span class="n">Ret</span><span class="p">,</span> <span class="n">JlFuncType</span><span class="p">}(</span><span class="n">f</span><span class="p">)</span></code></pre></div><p>根据<a href="https://link.zhihu.com/?target=https%3A//github.com/yuyichao/FunctionWrappers.jl" class=" wrap external" target="_blank" rel="nofollow noreferrer">FunctionWrappers.jl</a>, 这是一个相当高效的函数类型实现。</p><p>然而，问题在于它的使用非常不友好，需要人们进行大量的手工类型标注，这很烦人。</p><p>对于多态问题的解决尝试, 学术界的主流方案(基于类型的)在Julia这里不能奏效。你得准备收拾收拾 去搞LISP风格的&#34;多态&#34;， 我是说你得经常写宏。</p></div></div><div class="ContentItem-time">编辑于 2019-04-06</div><div class="Reward"><div><div class="Reward-tagline">真诚赞赏，手留余香<a class="Reward-editButton"><svg viewBox="0 0 12 12" class="Icon Icon--modify Icon--left" style="height:16px;width:14px" width="14" height="16" aria-hidden="true"><title></title><g><path d="M.423 10.32L0 12l1.667-.474 1.55-.44-2.4-2.33-.394 1.564zM10.153.233c-.327-.318-.85-.31-1.17.018l-.793.817 2.49 2.414.792-.814c.318-.328.312-.852-.017-1.17l-1.3-1.263zM3.84 10.536L1.35 8.122l6.265-6.46 2.49 2.414-6.265 6.46z" fill-rule="evenodd"/></g></svg><span>编辑</span></a></div></div><div class="Reward-countZero">还没有人赞赏。</div></div><div class="Post-topicsAndReviewer"><div class="TopicList Post-Topics"><div class="Tag Topic"><span class="Tag-content"><a class="TopicLink" href="//www.zhihu.com/topic/19678370" target="_blank"><div class="Popover"><div id="null-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="null-content">Julia（编程语言）</div></div></a></span></div><div class="Tag Topic"><span class="Tag-content"><a class="TopicLink" href="//www.zhihu.com/topic/19679700" target="_blank"><div class="Popover"><div id="null-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="null-content">编程范式</div></div></a></span></div><div class="Tag Topic"><span class="Tag-content"><a class="TopicLink" href="//www.zhihu.com/topic/19615452" target="_blank"><div class="Popover"><div id="null-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="null-content">计算机语言</div></div></a></span></div></div></div><div><div class="Sticky RichContent-actions is-bottom"><div class="ContentItem-actions"><span><button disabled="" aria-label="赞同 67" type="button" class="Button VoteButton VoteButton--up"><span style="display:inline-flex;align-items:center">​<svg class="Zi Zi--TriangleUp VoteButton-TriangleUp" fill="currentColor" viewBox="0 0 24 24" width="10" height="10"><path d="M2 18.242c0-.326.088-.532.237-.896l7.98-13.203C10.572 3.57 11.086 3 12 3c.915 0 1.429.571 1.784 1.143l7.98 13.203c.15.364.236.57.236.896 0 1.386-.875 1.9-1.955 1.9H3.955c-1.08 0-1.955-.517-1.955-1.9z" fill-rule="evenodd"></path></svg></span>赞同 67</button></span><button type="button" class="Button BottomActions-CommentBtn Button--plain Button--withIcon Button--withLabel"><span style="display:inline-flex;align-items:center">​<svg class="Zi Zi--Comment Button-zi" fill="currentColor" viewBox="0 0 24 24" width="1.2em" height="1.2em"><path d="M10.241 19.313a.97.97 0 0 0-.77.2 7.908 7.908 0 0 1-3.772 1.482.409.409 0 0 1-.38-.637 5.825 5.825 0 0 0 1.11-2.237.605.605 0 0 0-.227-.59A7.935 7.935 0 0 1 3 11.25C3 6.7 7.03 3 12 3s9 3.7 9 8.25-4.373 9.108-10.759 8.063z" fill-rule="evenodd"></path></svg></span>9 条评论</button><div class="Popover ShareMenu"><div class="ShareMenu-toggler" id="null-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="null-content"><button type="button" class="Button Button--plain Button--withIcon Button--withLabel"><span style="display:inline-flex;align-items:center">​<svg class="Zi Zi--Share Button-zi" fill="currentColor" viewBox="0 0 24 24" width="1.2em" height="1.2em"><path d="M2.931 7.89c-1.067.24-1.275 1.669-.318 2.207l5.277 2.908 8.168-4.776c.25-.127.477.198.273.39L9.05 14.66l.927 5.953c.18 1.084 1.593 1.376 2.182.456l9.644-15.242c.584-.892-.212-2.029-1.234-1.796L2.93 7.89z" fill-rule="evenodd"></path></svg></span>分享</button></div></div><button type="button" class="Button ContentItem-action Button--plain Button--withIcon Button--withLabel"><span style="display:inline-flex;align-items:center">​<svg class="Zi Zi--Star Button-zi" fill="currentColor" viewBox="0 0 24 24" width="1.2em" height="1.2em"><path d="M5.515 19.64l.918-5.355-3.89-3.792c-.926-.902-.639-1.784.64-1.97L8.56 7.74l2.404-4.871c.572-1.16 1.5-1.16 2.072 0L15.44 7.74l5.377.782c1.28.186 1.566 1.068.64 1.97l-3.89 3.793.918 5.354c.219 1.274-.532 1.82-1.676 1.218L12 18.33l-4.808 2.528c-1.145.602-1.896.056-1.677-1.218z" fill-rule="evenodd"></path></svg></span>收藏</button><div class="Post-ActionMenuButton"><div class="Popover"><div id="null-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="null-content"><button type="button" class="Button Button--plain Button--withIcon Button--withLabel"><span style="display:inline-flex;align-items:center">​<svg class="Zi Zi--Settings Button-zi" fill="currentColor" viewBox="0 0 24 24" width="1.2em" height="1.2em"><path d="M20.868 17.185a.896.896 0 0 1-.452.137c-.123 0-1.397-.26-1.617-.233-1.354.014-1.78 1.276-1.835 1.742-.055.453 0 .892.191 1.303a.8.8 0 0 1-.068.851C16.224 21.877 14.922 22 14.73 22a.548.548 0 0 1-.356-.151c-.11-.096-.685-1.138-1.069-1.468-1.304-.955-2.247-.329-2.63 0-.398.33-.672.7-.836 1.125a.632.632 0 0 1-.329.37c-1.354.426-2.918-.919-3.014-1.056a.564.564 0 0 1-.123-.356c-.014-.138.383-1.276.342-1.688-.342-1.9-1.836-1.687-2.096-1.673a3.192 3.192 0 0 0-.918.178.873.873 0 0 1-.59-.055c-.887-.462-1.136-2.332-1.109-2.51.055-.315.192-.521.438-.604.425-.164.809-.452 1.151-.85.931-1.262.343-2.25 0-2.634-.342-.356-.726-.645-1.15-.809-.138-.041-.234-.151-.33-.316-.38-1.434.613-2.552.867-2.77.255-.22.6-.055.723 0 .425.164.877.219 1.343.15C6.7 6.636 6.784 5.141 6.81 4.908c.014-.247-.11-1.29-.137-1.4a.488.488 0 0 1 .027-.315C7.317 2.178 9.071 2 9.222 2a.56.56 0 0 1 .439.178c.11.124.63 1.111 1 1.4.4.338 1.583.83 2.59.013.397-.274.959-1.29 1.082-1.413A.55.55 0 0 1 14.717 2c1.56 0 2.329 1.029 2.438 1.22a.458.458 0 0 1 .069.371c-.028.151-.329 1.152-.26 1.605.365 1.537 1.383 1.742 1.89 1.783.493.028 1.644-.356 1.809-.343a.63.63 0 0 1 .424.206c.535.31.85 1.715.905 2.14.027.233-.014.439-.11.562-.11.138-1.165.714-1.48 1.112-.855.982-.342 2.25-.068 2.606.26.37 1.22.905 1.288.96.15.137.26.302.315.494.146 1.413-.89 2.387-1.069 2.47zm-8.905-.535c.644 0 1.246-.123 1.822-.356a4.576 4.576 0 0 0 1.493-1.016 4.694 4.694 0 0 0 1-1.495c.247-.562.357-1.18.357-1.81 0-.659-.11-1.262-.356-1.825a4.79 4.79 0 0 0-1-1.481 4.542 4.542 0 0 0-1.494-1.002 4.796 4.796 0 0 0-3.631 0 4.627 4.627 0 0 0-1.48 1.002c-.424.425-.767.919-1 1.481a4.479 4.479 0 0 0-.37 1.825c0 .644.124 1.248.37 1.81a4.62 4.62 0 0 0 1 1.495c.425.426.918.768 1.48 1.016a4.677 4.677 0 0 0 1.809.356z" fill-rule="evenodd"></path></svg></span>设置</button></div></div></div></div></div></div></article><div class="Post-Sub Post-NormalSub"><div class="PostIndex-Contributions"><h3 class="BlockTitle">文章被以下专栏收录</h3><ul><div class="ContentItem Column-ColumnItem"><div class="ContentItem-main"><div class="ContentItem-image"><a class="ColumnLink" href="/c_103600054"><div class="Popover"><div id="null-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="null-content"><img class="Avatar Avatar--medium Avatar--round" width="40" height="40" src="https://pic1.zhimg.com/v2-e4e17a71e65bfa141d3f06c1c8d71f8f_xs.jpg" srcSet="https://pic1.zhimg.com/v2-e4e17a71e65bfa141d3f06c1c8d71f8f_l.jpg 2x" alt="红红娘的小码坊"/></div></div></a></div><div class="ContentItem-head"><h2 class="ContentItem-title"><a class="ColumnLink ColumnItem-Title" href="/c_103600054"><div class="Popover"><div id="null-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="null-content">红红娘的小码坊</div></div></a></h2><div class="ContentItem-meta">可能造轮子有点多。</div></div><div class="ContentItem-extra"><a href="/c_103600054" type="button" class="Button">进入专栏</a></div></div></div><div class="ContentItem Column-ColumnItem"><div class="ContentItem-main"><div class="ContentItem-image"><a class="ColumnLink" href="/c_123687550"><div class="Popover"><div id="null-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="null-content"><img class="Avatar Avatar--medium Avatar--round" width="40" height="40" src="https://pic1.zhimg.com/v2-9e3b70db749ea5002800fc20420f6cac_xs.jpg" srcSet="https://pic1.zhimg.com/v2-9e3b70db749ea5002800fc20420f6cac_l.jpg 2x" alt="啃面包和动态语言"/></div></div></a></div><div class="ContentItem-head"><h2 class="ContentItem-title"><a class="ColumnLink ColumnItem-Title" href="/c_123687550"><div class="Popover"><div id="null-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="null-content">啃面包和动态语言</div></div></a></h2><div class="ContentItem-meta">哦</div></div><div class="ContentItem-extra"><a href="/c_123687550" type="button" class="Button">进入专栏</a></div></div></div></ul></div></div></div></main></div></div><script id="js-clientConfig" type="text/json">{"host":"zhihu.com","protocol":"https:","wwwHost":"www.zhihu.com","zhuanlanHost":"zhuanlan.zhihu.com","apiHost":"api.zhihu.com"}</script><script id="js-initialData" type="text/json">{"initialState":{"common":{"ask":{}},"loading":{"global":{"count":0},"local":{"env\u002FgetIpinfo\u002F":false,"article\u002Fget\u002F":false,"brand\u002FgetUrl\u002F":false}},"entities":{"users":{"c3a3b37f42ed38a9783c00cea5156e55":{"uid":73724296429568,"userType":"people","id":"c3a3b37f42ed38a9783c00cea5156e55"},"zhao-wang-hong-xuan":{"isFollowed":false,"avatarUrlTemplate":"https:\u002F\u002Fpic4.zhimg.com\u002Fda8e974dc_{size}.jpg","uid":"73724296429568","userType":"people","isFollowing":false,"urlToken":"zhao-wang-hong-xuan","id":"c3a3b37f42ed38a9783c00cea5156e55","description":"blog: https:\u002F\u002Fthautwarm.github.io\u002FSite-32\u002F\n\ngithub, python\u002Fjulia community, reddit: thautwarm\n\n推: redyred","name":"平平淡淡红美铃","isAdvertiser":false,"headline":"编程, 编程语言等话题差劲回答者。","gender":1,"url":"\u002Fpeople\u002Fc3a3b37f42ed38a9783c00cea5156e55","avatarUrl":"https:\u002F\u002Fpic4.zhimg.com\u002Fda8e974dc_l.jpg","isOrg":false,"type":"people","badge":[],"exposedMedal":{"medalId":"972473506181627904","medalName":"有求必应","avatarUrl":"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-c9896ce7b5ab15bcb2812a8c44e3ee10_r.png","miniAvatarUrl":"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-34a8d79a9ba742eecda9bf41bcb31534_is.png","description":"受邀回答 15 个问题"}}},"questions":{},"answers":{},"articles":{"61537058":{"trackUrl":["https:\u002F\u002Fsugar.zhihu.com\u002Fplutus_adreaper\u002Fpage_monitor_log?si=__SESSIONID__&ti=__ATOKEN__&at=view&pf=__OS__&ed=BiBUKF0xBSkqGGNWA2F7Al93ZdtkaifVHYs=&idfa=__IDFA__&imei=__IMEI__&androidid= __ANDROIDID__"],"id":61537058,"title":"高观点下的Julia泛用编程","type":"article","excerptTitle":"","url":"https:\u002F\u002Fzhuanlan.zhihu.com\u002Fp\u002F61537058","imageUrl":"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-260c5a5d732d69d7378ffdf01403b92e_b.jpg","titleImage":"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-260c5a5d732d69d7378ffdf01403b92e_b.jpg","excerpt":"\u003Cimg src=\"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-29860a8b89ac912b793c7e252235eefd_200x112.png\" data-rawwidth=\"757\" data-rawheight=\"909\" data-size=\"normal\" data-caption=\"\" data-watermark=\"watermark\" data-original-src=\"v2-29860a8b89ac912b793c7e252235eefd\" data-watermark-src=\"v2-4f7e4549d9a6e8778cdef24b098981ef\" data-private-watermark-src=\"\" class=\"origin_image inline-img zh-lightbox-thumb\" data-original=\"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-29860a8b89ac912b793c7e252235eefd_r.png\"\u002F\u003E高观点下的Julia范用编程\u003Ca href=\"https:\u002F\u002Fjulialang.org\u002F\"\u003EJulia\u003C\u002Fa\u003E是一个支持可选类型标注的纯动态多范式语言。由于其引入的一些像For循环，While循环, If循环, 函数等的基本语言构造, 与Python, R或是MATLAB类似, Julia变得简单和简洁, 使得你可以仅用它一部分的语言特性便流畅地工作。 尽管…","created":1554478084,"updated":1554521165,"author":{"isFollowed":false,"avatarUrlTemplate":"https:\u002F\u002Fpic4.zhimg.com\u002Fda8e974dc_{size}.jpg","uid":"73724296429568","userType":"people","isFollowing":false,"urlToken":"zhao-wang-hong-xuan","id":"c3a3b37f42ed38a9783c00cea5156e55","description":"blog: https:\u002F\u002Fthautwarm.github.io\u002FSite-32\u002F\n\ngithub, python\u002Fjulia community, reddit: thautwarm\n\n推: redyred","name":"平平淡淡红美铃","isAdvertiser":false,"headline":"编程, 编程语言等话题差劲回答者。","gender":1,"url":"\u002Fpeople\u002Fc3a3b37f42ed38a9783c00cea5156e55","avatarUrl":"https:\u002F\u002Fpic4.zhimg.com\u002Fda8e974dc_l.jpg","isOrg":false,"type":"people","badge":[],"exposedMedal":{"medalId":"972473506181627904","medalName":"有求必应","avatarUrl":"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-c9896ce7b5ab15bcb2812a8c44e3ee10_r.png","miniAvatarUrl":"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-34a8d79a9ba742eecda9bf41bcb31534_is.png","description":"受邀回答 15 个问题"}},"commentPermission":"all","state":"published","imageWidth":855,"imageHeight":1200,"content":"\u003Cp\u003E高观点下的Julia范用编程\u003C\u002Fp\u003E\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fjulialang.org\u002F\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003EJulia\u003C\u002Fa\u003E是一个支持可选类型标注的纯动态多范式语言。\u003C\u002Fp\u003E\u003Cp\u003E由于其引入的一些像For循环，While循环, If循环, 函数等的基本语言构造, 与Python, R或是MATLAB类似, Julia变得简单和简洁, 使得你可以仅用它一部分的语言特性便流畅地工作。\u003C\u002Fp\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Cfigure data-size=\"normal\"\u003E\u003Cnoscript\u003E\u003Cimg src=\"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-4f7e4549d9a6e8778cdef24b098981ef_b.jpg\" data-rawwidth=\"757\" data-rawheight=\"909\" data-size=\"normal\" data-caption=\"\" class=\"origin_image zh-lightbox-thumb\" width=\"757\" data-original=\"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-4f7e4549d9a6e8778cdef24b098981ef_r.jpg\"\u002F\u003E\u003C\u002Fnoscript\u003E\u003Cimg src=\"data:image\u002Fsvg+xml;utf8,&lt;svg xmlns=&#39;http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg&#39; width=&#39;757&#39; height=&#39;909&#39;&gt;&lt;\u002Fsvg&gt;\" data-rawwidth=\"757\" data-rawheight=\"909\" data-size=\"normal\" data-caption=\"\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"757\" data-original=\"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-4f7e4549d9a6e8778cdef24b098981ef_r.jpg\" data-actualsrc=\"https:\u002F\u002Fpic4.zhimg.com\u002Fv2-4f7e4549d9a6e8778cdef24b098981ef_b.jpg\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cp\u003E尽管人们很少关注Julia除开高性能以外的语言特性(截止2019年4月)，我的角度却是在它的泛用编程方面。\u003C\u002Fp\u003E\u003Ch2\u003EFirst-Class\u003C\u002Fh2\u003E\u003Cp\u003EJulia中, 几乎所有的语言构造都是\u003Cb\u003Efirst-class\u003C\u002Fb\u003E的，使得语言的灵活性和可组合性得以彰显。\u003C\u002Fp\u003E\u003Cp\u003E很多人对于Python缺少多行lambda这事抱有偏见。尽管把多行lambda编译到通常的Python code object是相当平凡和直接的, 前端，更具体点，强制缩进，通过严格分离表达式和语句(语句无法出现在表达式中), 限制了Python的表达力, 也失去了 first-class。其他的没有限制expression-first的语言缩进方式是有的，例如ML家族和Haskell, 但还没有被Python社区所采纳。\u003C\u002Fp\u003E\u003Cp\u003EJulia看起来有点过于first-class, 因为它所有的构造都是表达式, 在语法上讲并不限制任意语言构造的组合。\u003Cb\u003E定义\u003C\u002Fb\u003E和\u003Cb\u003E计算\u003C\u002Fb\u003E在很多主流的函数式语言中是分离的，只是两者的组成里各自包含对方。\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-julia\"\u003E\u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"k\"\u003Elet\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ey\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ef\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ex\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ex\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ey\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Eend\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Efor\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ex\u003C\u002Fspan\u003E \u003Cspan class=\"kp\"\u003Ein\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Epoints\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Emap\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Efunction\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Emap_fn\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ex\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n        \u003Cspan class=\"c\"\u003E# 做一些事情\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Eend\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Epoints\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"k\"\u003Elet\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ebind_maybe\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ea\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ef\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E-&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ea\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E==\u003C\u002Fspan\u003E \u003Cspan class=\"nb\"\u003Enothing\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E?\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ef\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ea\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"nb\"\u003Enothing\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\n    \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E|&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ebind_maybe\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"n\"\u003Einit\u003C\u002Fspan\u003E          \u003Cspan class=\"o\"\u003E|&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ea\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E-&gt;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Edo1_stuffs\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ea\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E|&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ea\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E-&gt;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"o\"\u003E...\u003C\u002Fspan\u003E           \u003Cspan class=\"o\"\u003E|&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ea\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E-&gt;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"o\"\u003E...\u003C\u002Fspan\u003E           \u003Cspan class=\"o\"\u003E|&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ea\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E-&gt;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"o\"\u003E...\u003C\u002Fspan\u003E\n\u003Cspan class=\"k\"\u003Eend\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E为什么可组合性很关键的原因多年来被经常讨论，所以我不会就此再整一个。 对于Julia而言，first-class在涉及\u003Cb\u003E代码即数据\u003C\u002Fb\u003E时会很有用, 文章稍后展开这点。\u003C\u002Fp\u003E\u003Ch2\u003E多重分派的多态\u003C\u002Fh2\u003E\u003Cp\u003EJulia支持多态，以实现必要的抽象，减少self-repeating，尽管和那些流行的工业语言有着明显的不同。\u003C\u002Fp\u003E\u003Cp\u003E多重分派看起来有点像参数化多态, 但实际上其含义比起后者要多。\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-julia\"\u003E  \u003Cspan class=\"k\"\u003Efunction\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eusum\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ex\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003EVector\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ET\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E})\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ewhere\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ET\u003C\u002Fspan\u003E\n      \u003Cspan class=\"n\"\u003Es\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ezero\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ET\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n      \u003Cspan class=\"k\"\u003Efor\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eeach\u003C\u002Fspan\u003E \u003Cspan class=\"kp\"\u003Ein\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ex\u003C\u002Fspan\u003E\n         \u003Cspan class=\"n\"\u003Es\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E+=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eeach\u003C\u002Fspan\u003E\n      \u003Cspan class=\"k\"\u003Eend\u003C\u002Fspan\u003E\n      \u003Cspan class=\"n\"\u003Es\u003C\u002Fspan\u003E\n   \u003Cspan class=\"k\"\u003Eend\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E重载也是可以的。\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-julia\"\u003E\u003Cspan class=\"n\"\u003Euzero\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003E_\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003EType\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003EInt\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E})\u003C\u002Fspan\u003E     \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Euzero\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E  \u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003EType\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003EFloat64\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E})\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"mf\"\u003E0.0\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E然而多重分派不仅仅是我上面列举的。实际上类型只是可分派的不可变数据的一种特殊实例， 你能够用不可变的数据来分派，不管它是类型还是别的什么劳什子。\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-julia\"\u003E   \u003Cspan class=\"k\"\u003Estruct\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EConst\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ET\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n   \u003Cspan class=\"k\"\u003Eend\u003C\u002Fspan\u003E\n\n   \u003Cspan class=\"n\"\u003Eflip\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003EType\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EConst\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eeven\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E}})\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EConst\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eodd\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n   \u003Cspan class=\"n\"\u003Eflip\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003EType\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EConst\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eodd\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E}})\u003C\u002Fspan\u003E  \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EConst\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eeven\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\n   \u003Cspan class=\"n\"\u003Ef\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003EType\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EConst\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E}})\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EConst\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eeven\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n   \u003Cspan class=\"n\"\u003Ef\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003EType\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EConst\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E}})\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EConst\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eodd\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n   \u003Cspan class=\"n\"\u003Ef\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003EType\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EConst\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EN\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E}})\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ewhere\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EN\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ef\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EConst\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EN\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E-\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E})\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E|&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eflip\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E使用上述代码，我们可以如期地静态计算数字的奇偶性。\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-julia\"\u003E   \u003Cspan class=\"n\"\u003Ejulia\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"nd\"\u003E@code_warntype\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ef\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EConst\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E2\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E})\u003C\u002Fspan\u003E\n\n   \u003Cspan class=\"n\"\u003EBody\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003EType\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EConst\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eeven\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E}}\u003C\u002Fspan\u003E\n     \u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003E─\u003C\u002Fspan\u003E     \u003Cspan class=\"k\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EConst\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eeven\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E注意，如果多重分派在静态推断上失败，它将表现得如同Python中的动态分派一般。\u003C\u002Fp\u003E\u003Ch2\u003EFull-Featured的宏\u003C\u002Fh2\u003E\u003Cp\u003E宏是实现代码复用的极少途径之一, 也是为什么有一些程序员千百倍高效于其他人的原因。\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-julia\"\u003E  \u003Cspan class=\"n\"\u003Ejulia\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Emacro\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Egen_var\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003En\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003EInt\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ef\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n         \u003Cspan class=\"n\"\u003Edefs\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003EExpr\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E),\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003ESymbol\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"s\"\u003E&#34;var&#34;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ei\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E),\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E$\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ef\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E$\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ei\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)))\u003C\u002Fspan\u003E  \u003Cspan class=\"k\"\u003Efor\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ei\u003C\u002Fspan\u003E \u003Cspan class=\"kp\"\u003Ein\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003En\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]\u003C\u002Fspan\u003E\n         \u003Cspan class=\"n\"\u003Eesc\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003EExpr\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eblock\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E  \u003Cspan class=\"n\"\u003Edefs\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E...\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"nb\"\u003Enothing\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E))\u003C\u002Fspan\u003E\n       \u003Cspan class=\"k\"\u003Eend\u003C\u002Fspan\u003E\n\n  \u003Cspan class=\"nd\"\u003E@gen_var\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"k\"\u003Emacro\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ewith\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Emethod\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\n  \u003Cspan class=\"n\"\u003Ejulia\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ef\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ex\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ex\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E10\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E2\u003C\u002Fspan\u003E\n  \u003Cspan class=\"n\"\u003Ef\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Egeneric\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Efunction\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ewith\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Emethod\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\n  \u003Cspan class=\"n\"\u003Ejulia\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"nd\"\u003E@gen_var\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ef\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ex\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E10\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E2\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\n  \u003Cspan class=\"n\"\u003Ejulia\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Evar1\u003C\u002Fspan\u003E\n  \u003Cspan class=\"mi\"\u003E8\u003C\u002Fspan\u003E\n\n  \u003Cspan class=\"n\"\u003Ejulia\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Evar2\u003C\u002Fspan\u003E\n  \u003Cspan class=\"mi\"\u003E18\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Ch2\u003E宏，从AST到AST的函数\u003C\u002Fh2\u003E\u003Cp\u003E一旦你知道宏是从AST到AST的函数后，Julia的宏便不再神秘。\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-julia\"\u003E   \u003Cspan class=\"k\"\u003Emacro\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ef\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ex\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n     \u003Cspan class=\"n\"\u003Eprintln\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ex\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n     \u003Cspan class=\"o\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E$\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ex\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n   \u003Cspan class=\"k\"\u003Eend\u003C\u002Fspan\u003E\n\n   \u003Cspan class=\"nd\"\u003E@assert\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"nd\"\u003E@f\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E==\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E2\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E上述代码展示了Julia宏的一个生动例子。首先 \u003Ccode\u003Emacro\u003C\u002Fcode\u003E 关键字引导宏变换规则的定义，而\u003Ccode\u003E@f\u003C\u002Fcode\u003E标记来对应宏规则的调用点。\u003C\u002Fp\u003E\u003Cp\u003E你可能会问为什么\u003Ccode\u003E(@f 1 == 2\u003C\u002Fcode\u003E, 因为宏\u003Ccode\u003E@f\u003C\u002Fcode\u003E的返回值是一个AST，看起来让它和整数\u003Ccode\u003E2\u003C\u002Fcode\u003E相等有点魔幻。\u003C\u002Fp\u003E\u003Cp\u003E认真看\u003Ccode\u003E@assert (@f 1) == 2\u003C\u002Fcode\u003E。由于宏调用是从内到外依次处理的，我们首先处理的应该是\u003Ccode\u003E@f 1\u003C\u002Fcode\u003E。\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-julia\"\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"k\"\u003Efunction\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ef\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ex\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n      \u003Cspan class=\"n\"\u003Eprintln\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ex\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n     \u003Cspan class=\"o\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E$\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ex\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E         \u003Cspan class=\"o\"\u003E=&gt;\u003C\u002Fspan\u003E  \u003Cspan class=\"o\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n  \u003Cspan class=\"k\"\u003Eend\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)(\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E上面这步，在执行AST到AST的函数\u003Ccode\u003Ef\u003C\u002Fcode\u003E, 即宏\u003Ccode\u003E@f\u003C\u002Fcode\u003E, 的时候，还会写stdio.\u003C\u002Fp\u003E\u003Cp\u003E随后，由于我们已经拿到一个输出, AST \u003Ccode\u003E:(1 + 1)\u003C\u002Fcode\u003E, 设想我们用它置换先前代码中的\u003Ccode\u003E@f 1\u003C\u002Fcode\u003E，这会产生一个\u003Ccode\u003E@assert $(:(1 + 1)) == 2\u003C\u002Fcode\u003E, 化简它，然后我们得到\u003Ccode\u003E@assert (1 + 1) == 2\u003C\u002Fcode\u003E。\u003C\u002Fp\u003E\u003Cp\u003E你可能会问为什么\u003Ccode\u003E@assert :(1 + 1) == 2\u003C\u002Fcode\u003E, 好问题，我们深入研究一个。\u003C\u002Fp\u003E\u003Cp\u003E想想如果你从宏调用处返回的是一个运行时AST，它不会被转换为要编译的代码，以至于这样的宏会变得完全没有用。\u003C\u002Fp\u003E\u003Cp\u003E如果我们\u003Ci\u003Eunquote\u003C\u002Fi\u003E宏的返回，\u003C\u002Fp\u003E\u003Cfigure data-size=\"normal\"\u003E\u003Cnoscript\u003E\u003Cimg src=\"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-ddd869022dcf1dfae3942de0ffcf4a76_b.jpg\" data-rawwidth=\"868\" data-rawheight=\"314\" data-size=\"normal\" data-caption=\"\" class=\"origin_image zh-lightbox-thumb\" width=\"868\" data-original=\"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-ddd869022dcf1dfae3942de0ffcf4a76_r.jpg\"\u002F\u003E\u003C\u002Fnoscript\u003E\u003Cimg src=\"data:image\u002Fsvg+xml;utf8,&lt;svg xmlns=&#39;http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg&#39; width=&#39;868&#39; height=&#39;314&#39;&gt;&lt;\u002Fsvg&gt;\" data-rawwidth=\"868\" data-rawheight=\"314\" data-size=\"normal\" data-caption=\"\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"868\" data-original=\"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-ddd869022dcf1dfae3942de0ffcf4a76_r.jpg\" data-actualsrc=\"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-ddd869022dcf1dfae3942de0ffcf4a76_b.jpg\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Cp\u003E上面的表格揭示了AST插值的规则，以及，很明显这里有点东西: 如果我们说一个表达式被quote了N次，那么它的插值，作为一个表达式被quote了\u003Ccode\u003Emax(0, N - 1)\u003C\u002Fcode\u003E次。\u003C\u002Fp\u003E\u003Ch2\u003E作用域和卫生\u003C\u002Fh2\u003E\u003Cp\u003E只要你站在宏是AST到AST的函数这个观点下， 宏(返回的AST)的作用域规则会很简单。\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-julia\"\u003E  \u003Cspan class=\"n\"\u003Ejulia\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Emodule\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EA\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Evar\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Emacro\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ema\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E\n      \u003Cspan class=\"k\"\u003Equote\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003Evar\u003C\u002Fspan\u003E\n      \u003Cspan class=\"k\"\u003Eend\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Eend\u003C\u002Fspan\u003E\n  \u003Cspan class=\"k\"\u003Eend\u003C\u002Fspan\u003E\n\n  \u003Cspan class=\"n\"\u003Ejulia\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Evar\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E5555\u003C\u002Fspan\u003E\n\n  \u003Cspan class=\"n\"\u003Ejulia\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EA\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"nd\"\u003E@ma\u003C\u002Fspan\u003E\n  \u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\n\n  \u003Cspan class=\"n\"\u003Ejulia\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Eusing\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EA\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"nd\"\u003E@ma\u003C\u002Fspan\u003E\n\n  \u003Cspan class=\"n\"\u003Ejulia\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"nd\"\u003E@ma\u003C\u002Fspan\u003E\n  \u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E我这儿要说的第一点是, 宏返回的表达式是在宏定义处的模块被求值的。\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-julia\"\u003E  \u003Cspan class=\"k\"\u003Emacro\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eassign_y\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ex\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n     \u003Cspan class=\"o\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ey\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E$\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ex\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n  \u003Cspan class=\"k\"\u003Eend\u003C\u002Fspan\u003E\n\n  \u003Cspan class=\"k\"\u003Efunction\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ef\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ex\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n    \u003Cspan class=\"nd\"\u003E@assign_y\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ex\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Ey\u003C\u002Fspan\u003E\n  \u003Cspan class=\"k\"\u003Eend\u003C\u002Fspan\u003E\n\n  \u003Cspan class=\"n\"\u003Ef\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E你可能期望这代码能预期跑通，但很不幸，不行，只会给你扔一个\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-julia\"\u003E\u003Cspan class=\"n\"\u003EERROR\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003EUndefVarError\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ex\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Enot\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Edefined\u003C\u002Fspan\u003E\n  \u003Cspan class=\"n\"\u003EStacktrace\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E:\u003C\u002Fspan\u003E\n  \u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ef\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003EInt64\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eat\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E.\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EREPL\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E6\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E2\u003C\u002Fspan\u003E\n  \u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E2\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Etop\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E-\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Elevel\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Escope\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eat\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Enone\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E这里的原因是，AST插值会被预先处理，以确保所有的裸符号(没有包在\u003Ccode\u003EQuoteNode\u003C\u002Fcode\u003E和更深的quote中)会被 转换到像\u003Ccode\u003E##a#168\u003C\u002Fcode\u003E这样有点奇怪的\u003Cb\u003Emangled\u003C\u002Fb\u003E符号(也被称为\u003Ci\u003Egensym\u003C\u002Fi\u003E). 同时，Julia干这事儿的原因， 是为了默认避免为局部作用域产生新的可见符号。\u003C\u002Fp\u003E\u003Cp\u003E想想你想打算在计算了值后进行打印的宏:\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-julia\"\u003E   \u003Cspan class=\"k\"\u003Emacro\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ewith_logging\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eexpr\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n      \u003Cspan class=\"k\"\u003Equote\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003Ea\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E$\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eexpr\u003C\u002Fspan\u003E\n        \u003Cspan class=\"nd\"\u003E@info\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Elogging\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ea\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003Ea\u003C\u002Fspan\u003E\n      \u003Cspan class=\"k\"\u003Eend\u003C\u002Fspan\u003E\n   \u003Cspan class=\"k\"\u003Eend\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E我们没把符号\u003Ccode\u003Ea\u003C\u002Fcode\u003E转换到类似\u003Ccode\u003E##a#167\u003C\u002Fcode\u003E这样子，假如你已经在你的代码里定义了\u003Ccode\u003Ea\u003C\u002Fcode\u003E呢?\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-julia\"\u003E  \u003Cspan class=\"k\"\u003Efunction\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ex5\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ea\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"c\"\u003E# 把它当作乘5\u003C\u002Fspan\u003E\n      \u003Cspan class=\"n\"\u003Ex2\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"nd\"\u003E@with_logging\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E2\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ea\u003C\u002Fspan\u003E\n      \u003Cspan class=\"n\"\u003Ex3\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"nd\"\u003E@with_logging\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E3\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ea\u003C\u002Fspan\u003E\n      \u003Cspan class=\"n\"\u003Ex2\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ex3\u003C\u002Fspan\u003E\n  \u003Cspan class=\"k\"\u003Eend\u003C\u002Fspan\u003E\n\n  \u003Cspan class=\"n\"\u003Emy_func\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E你可以看见如果宏\u003Ccode\u003Ewith_logging\u003C\u002Fcode\u003E不转换宏定义体里写的\u003Ccode\u003Ea\u003C\u002Fcode\u003E, 你将会得到\u003Ccode\u003Ex5(1) == 8\u003C\u002Fcode\u003E而不是\u003Ccode\u003Ex5(1) == 5\u003C\u002Fcode\u003E。\u003C\u002Fp\u003E\u003Cp\u003E就是这样，我们叫这样的宏，\u003Cb\u003E卫生宏\u003C\u002Fb\u003E。\u003C\u002Fp\u003E\u003Cp\u003E但是还有一些上下文有关的代码生成，你想要在多个代码生成函数中共享作用域。一个有点东西的例子是 我的MLStyle, 它实现了我自学习编程以来的一个梦想，即能够使用一个高性能且可扩展(可自定义)的模式匹配。 在这个包里，在编译模式的时候，我会使用手动的gensym而不是依靠卫生宏，因为我可能在不同的会生成代码的函数里 访问某些指定的符号。\u003C\u002Fp\u003E\u003Cp\u003E在这种情况下，人们想要产生可以污染作用域的符号，Julia提供来一种转义(escaped)机制来避免gensym.\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-julia\"\u003E  \u003Cspan class=\"k\"\u003Emacro\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eassign_y\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ex\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n     \u003Cspan class=\"n\"\u003Eesc\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ey\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E$\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ex\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E))\u003C\u002Fspan\u003E\n  \u003Cspan class=\"k\"\u003Eend\u003C\u002Fspan\u003E\n\n  \u003Cspan class=\"k\"\u003Efunction\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ef\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ex\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n    \u003Cspan class=\"nd\"\u003E@assign_y\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ex\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Ey\u003C\u002Fspan\u003E\n  \u003Cspan class=\"k\"\u003Eend\u003C\u002Fspan\u003E\n\n  \u003Cspan class=\"n\"\u003Ef\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"c\"\u003E# 1\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E先前的代码, 在返回的AST上补充了一个\u003Ccode\u003Eesc\u003C\u002Fcode\u003E的调用后，便可以正常工作。\u003C\u002Fp\u003E\u003Ch2\u003E其他对Julia宏有用的知识点\u003C\u002Fh2\u003E\u003Col\u003E\u003Cli\u003E\u003Ccode\u003E@__MODULE__\u003C\u002Fcode\u003E会给当前模块。\u003C\u002Fli\u003E\u003Cli\u003E当你想要控制求值(evaluate) AST的模块时，你可以用\u003Ccode\u003EmoduleX.eval(expr)\u003C\u002Fcode\u003E 或者 \u003Ccode\u003E@eval moduleX expr\u003C\u002Fcode\u003E。\u003C\u002Fli\u003E\u003Cli\u003E尽管我们已经知道宏是函数，一些需要强调的事情是，这里有两个隐式的参数: \u003Ccode\u003E__module__\u003C\u002Fcode\u003E 和 \u003Ccode\u003E__source__\u003C\u002Fcode\u003E, \u003Ccode\u003E__module__\u003C\u002Fcode\u003E    是你调用该宏时所处的模块，\u003Ccode\u003E__source__\u003C\u002Fcode\u003E是该宏调用的行号结点。\u003C\u002Fli\u003E\u003C\u002Fol\u003E\u003Ch2\u003EAST操作上的进步\u003C\u002Fh2\u003E\u003Cp\u003EJulia在AST上搞得很多，比如，分析，替换，重写，诸如此类。\u003C\u002Fp\u003E\u003Cp\u003E由于我们已经介绍来AST的插值规则，你可能已经知道我们能像下面代码那样产生AST，而不是用纯粹的构造性的方式。\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-julia\"\u003E  \u003Cspan class=\"n\"\u003Eex0\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E2\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E3\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]\u003C\u002Fspan\u003E\n  \u003Cspan class=\"n\"\u003Eex1\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E2\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E3\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]\u003C\u002Fspan\u003E\n\n  \u003Cspan class=\"n\"\u003Eex2\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E$\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eex0\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n  \u003Cspan class=\"c\"\u003E# :([1, 2, 3] + 1), [1, 2, 3] here is already evaluated before interpolation.\u003C\u002Fspan\u003E\n\n  \u003Cspan class=\"n\"\u003Eex3\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E$\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eex1\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n  \u003Cspan class=\"c\"\u003E# :([1, 2, 3] + 1)\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E这不是那么酷炫，因为现阶段其他的语言也有接近这样的支持。\u003C\u002Fp\u003E\u003Cp\u003E进步在于对于AST的解构, 这极大地影响了我们可以用来分析AST的方式。\u003C\u002Fp\u003E\u003Cp\u003E考虑这样一种情况，你想要从函数调用处搜集所有的位置参数和关键字参数。\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-julia\"\u003E  \u003Cspan class=\"n\"\u003Eget_arg_info\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ef\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ea\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eb\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ec\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eb\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E2\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)))\u003C\u002Fspan\u003E \u003Cspan class=\"c\"\u003E# =&gt; ([:a, :b, :(c = 1)], [:(b = 2)])\u003C\u002Fspan\u003E\n  \u003Cspan class=\"n\"\u003Eget_arg_info\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ef\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eargs\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E...\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ekwargs\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E...\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)))\u003C\u002Fspan\u003E \u003Cspan class=\"c\"\u003E# =&gt; ([:(args...)], [:(kwargs...)])\u003C\u002Fspan\u003E\n  \u003Cspan class=\"n\"\u003Eget_arg_info\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ef\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ea\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eb\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ec\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)))\u003C\u002Fspan\u003E            \u003Cspan class=\"c\"\u003E# =&gt; ([:a, :b, :c], [])\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E你会如何干这事？\u003C\u002Fp\u003E\u003Cp\u003E注意！无论你打算如何处理它，想想你是否需要对Julia的AST有一个预先的了解? 比方说，你不得不知道 \u003Ccode\u003EExpr\u003C\u002Fcode\u003E(正是Julia AST的类型中最为重要的一种)有两个fields, \u003Ccode\u003Ehead\u003C\u002Fcode\u003E和\u003Ccode\u003Eargs\u003C\u002Fcode\u003E， 或者你不得不理解 \u003Ccode\u003Ea.b\u003C\u002Fcode\u003E的结构是\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-julia\"\u003E  \u003Cspan class=\"kt\"\u003EExpr\u003C\u002Fspan\u003E\n  \u003Cspan class=\"n\"\u003Ehead\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003ESymbol\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\n  \u003Cspan class=\"n\"\u003Eargs\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003EArray\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003EAny\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E}((\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E2\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,))\u003C\u002Fspan\u003E\n    \u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003ESymbol\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ea\u003C\u002Fspan\u003E\n    \u003Cspan class=\"mi\"\u003E2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003EQuoteNode\u003C\u002Fspan\u003E\n      \u003Cspan class=\"n\"\u003Evalue\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003ESymbol\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eb\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E而非\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-julia\"\u003E  \u003Cspan class=\"kt\"\u003EExpr\u003C\u002Fspan\u003E\n  \u003Cspan class=\"n\"\u003Ehead\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003ESymbol\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\n  \u003Cspan class=\"n\"\u003Eargs\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003EArray\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003EAny\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E}((\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E2\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,))\u003C\u002Fspan\u003E\n    \u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003ESymbol\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ea\u003C\u002Fspan\u003E\n    \u003Cspan class=\"mi\"\u003E2\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003ESymbol\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eb\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E或者你不得不搞清楚，对于向量的字面量，有\u003C\u002Fp\u003E\u003Cfigure data-size=\"normal\"\u003E\u003Cnoscript\u003E\u003Cimg src=\"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-d354dcdc6ae02c7bc2fcef5bb496a44a_b.jpg\" data-rawwidth=\"874\" data-rawheight=\"828\" data-size=\"normal\" data-caption=\"\" class=\"origin_image zh-lightbox-thumb\" width=\"874\" data-original=\"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-d354dcdc6ae02c7bc2fcef5bb496a44a_r.jpg\"\u002F\u003E\u003C\u002Fnoscript\u003E\u003Cimg src=\"data:image\u002Fsvg+xml;utf8,&lt;svg xmlns=&#39;http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg&#39; width=&#39;874&#39; height=&#39;828&#39;&gt;&lt;\u002Fsvg&gt;\" data-rawwidth=\"874\" data-rawheight=\"828\" data-size=\"normal\" data-caption=\"\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"874\" data-original=\"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-d354dcdc6ae02c7bc2fcef5bb496a44a_r.jpg\" data-actualsrc=\"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-d354dcdc6ae02c7bc2fcef5bb496a44a_b.jpg\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Cp\u003E说实在的，这里有这么多的关于结构的细节问题，但是当你需要使用 Julia AST工作(包括对结构的分析)时，你真的有必要知晓所有东西吗？\u003C\u002Fp\u003E\u003Cp\u003E不!当然是不用的!尽管我知道, 你们中一些时间更长的Julia使用者, 总是通过你们 丰富的Julia internal知识来检查以及分解AST，但我真诚地建议你开始使用MLStyle.jl, 为了你的效率起见。\u003C\u002Fp\u003E\u003Cp\u003E在此，我会介绍\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fthautwarm.github.io\u002FMLStyle.jl\u002Flatest\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003EMLStyle的AST操作\u003C\u002Fa\u003E 来给你一些有印象深刻的例子。 当然，这个包会在某一天被更好的替代，但其本质的方法论不会偏离分毫。现在不要马上打开链接，跟着我的介绍走，你不需要 对一个具体的包或者框架过分在意，除了它的核心思想。\u003C\u002Fp\u003E\u003Cp\u003E一个重要的灵感在2018年的某一天降临了我: 假如我们可以\u003Cb\u003E用构造AST的方式去解构AST\u003C\u002Fb\u003E，会怎么样？\u003C\u002Fp\u003E\u003Cp\u003E实际上，你并不需要精确地知道所有AST的结构，在你开始写它对应的语法的时候。比如你可以写\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-julia\"\u003E  \u003Cspan class=\"n\"\u003Ea\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E2\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E3\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]\u003C\u002Fspan\u003E\n  \u003Cspan class=\"n\"\u003Eb\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E2\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E3\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]\u003C\u002Fspan\u003E\n  \u003Cspan class=\"n\"\u003Ec\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E2\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E3\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]\u003C\u002Fspan\u003E\n  \u003Cspan class=\"n\"\u003Ed\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E2\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E3\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E4\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E你需要知道他们的AST长什么样吗？不用的。\u003C\u002Fp\u003E\u003Cp\u003E我有个仅仅学数学，此前从来不接触编程的同学, 也可以流畅地写出这样的代码来解决他的线性代数作业, 但当我尝试跟他讲AST的概念, 以及他刚写的代码的AST长什么样时，他感觉非常恼火。\u003C\u002Fp\u003E\u003Cp\u003E你或许已经注意到了使用语法要素的重要性。是的，在像数据一样处理代码的方面，它将 取得巨大的进步。\u003C\u002Fp\u003E\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fen.wikipedia.org\u002Fwiki\u002FPattern_matching\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E模式匹配\u003C\u002Fa\u003E是现代函数式语言中的一个基本设施， 通过\u003Cb\u003E像构造数据一样进行解构\u003C\u002Fb\u003E, 它能够降低处理几乎所有逻辑时的复杂性。\u003C\u002Fp\u003E\u003Cp\u003E好的，这句话出现两次了:\u003C\u002Fp\u003E\u003Cp\u003E\u003Cb\u003E像构造数据一样进行解构\u003C\u002Fb\u003E.\u003C\u002Fp\u003E\u003Cp\u003E记住它，它是我们这一节的根本准则。\u003C\u002Fp\u003E\u003Cp\u003E让我们想想AST是怎么被构造的?\u003C\u002Fp\u003E\u003Cp\u003E首先，我们可以写生(类似生开水的生)的AST，字面地写它。\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-julia\"\u003E\u003Cspan class=\"n\"\u003Eex\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ea\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Eex\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E2\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E3\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E然后，我们有AST插值。\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-julia\"\u003E\u003Cspan class=\"n\"\u003Eex\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E2\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E3\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Eex\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E$\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eex\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"c\"\u003E# :([1, 2, 3] + 1)\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E这就够了。现在让我们介绍\u003Ccode\u003E@match\u003C\u002Fcode\u003E. 这个语法可能会在你的时间点下被更好的类似物替代， 但利用你读这篇文章时最好的模式匹配库， 你必然可以轻易地实现等价乃至更好的东西。\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-julia\"\u003E  \u003Cspan class=\"nd\"\u003E@match\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Evalue\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Ebegin\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Epattern1\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Evalue1\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Epattern2\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Evalue2\u003C\u002Fspan\u003E\n  \u003Cspan class=\"k\"\u003Eend\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E为了支持匹配字面量AST， 我们必须要求下列代码返回\u003Ccode\u003Etrue\u003C\u002Fcode\u003E.\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-julia\"\u003E  \u003Cspan class=\"c\"\u003E# rmlines is a function that removes all line number nodes in an AST.\u003C\u002Fspan\u003E\n  \u003Cspan class=\"c\"\u003E# you can fetch it here : https:\u002F\u002Fgithub.com\u002Fthautwarm\u002FMLStyle.jl#preview\u003C\u002Fspan\u003E\n\n  \u003Cspan class=\"nd\"\u003E@match\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ermlines\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"k\"\u003Elet\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ex\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ex\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Eend\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E))\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Ebegin\u003C\u002Fspan\u003E\n    \u003Cspan class=\"o\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"k\"\u003Elet\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ex\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ex\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Eend\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"kc\"\u003Etrue\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003E_\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"kc\"\u003Efalse\u003C\u002Fspan\u003E\n  \u003Cspan class=\"k\"\u003Eend\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E想想我们已经建立其的那个根本准则, 好吧，我又会重复它一遍因为我是个 劣质的复读机:\u003C\u002Fp\u003E\u003Cp\u003E\u003Cb\u003E像构造数据一样进行解构\u003C\u002Fb\u003E.\u003C\u002Fp\u003E\u003Cp\u003E然后\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-julia\"\u003E  \u003Cspan class=\"n\"\u003Ev\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E2\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E3\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]\u003C\u002Fspan\u003E\n  \u003Cspan class=\"n\"\u003Eex\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E$\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ev\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n  \u003Cspan class=\"nd\"\u003E@match\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eex\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Ebegin\u003C\u002Fspan\u003E\n    \u003Cspan class=\"o\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E$\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ev\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ev\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E==\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E2\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E3\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003E_\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"kc\"\u003Efalse\u003C\u002Fspan\u003E\n  \u003Cspan class=\"k\"\u003Eend\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E嗷! 你懂吗? 你感觉这个有点东西吗?\u003C\u002Fp\u003E\u003Cp\u003EAST插值对应着构造，那么出现在模式中的AST插值就表示解构。我们可以把它叫做&#34;AST摘要&#34;。\u003C\u002Fp\u003E\u003Cp\u003E现在，然后我们回到最开始的问题，实现之前提到的\u003Ccode\u003Eget_arg_info\u003C\u002Fcode\u003E。\u003C\u002Fp\u003E\u003Cp\u003E首先， 我们用一些例子来介绍\u003Ccode\u003Eget_arg_info\u003C\u002Fcode\u003E情形下的构造。\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-julia\"\u003E  \u003Cspan class=\"n\"\u003Ef\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ea\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eb\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ec\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ed\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ea\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eb\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ec\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ed\u003C\u002Fspan\u003E\n  \u003Cspan class=\"n\"\u003Eargs\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E2\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]\u003C\u002Fspan\u003E\n  \u003Cspan class=\"n\"\u003Ekwargs\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003EDict\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ec\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ed\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E2\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n  \u003Cspan class=\"n\"\u003Ef\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eargs\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E...\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ekwargs\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E...\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E这会给出结果六。\u003C\u002Fp\u003E\u003Cp\u003E注意形式\u003Ccode\u003Ef(args...; kwargs...)\u003C\u002Fcode\u003E, 这貌似表示，在AST层面上，位置参数和关键字参数都是用数组来存的。\u003C\u002Fp\u003E\u003Cp\u003E试试:\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-julia\"\u003E  \u003Cspan class=\"n\"\u003Eargs\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ea\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eb\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]\u003C\u002Fspan\u003E\n  \u003Cspan class=\"o\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ef\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E$\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eargs\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E...\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)))\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E然后你能够拿到一个输出，恰好是\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003E:(f(a, b))\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E很好，好极了。现在我们再用MLStyle的\u003Ccode\u003E@match\u003C\u002Fcode\u003E, 还是遵守\u003Cb\u003E像构造数据一样进行解构\u003C\u002Fb\u003E的规矩。\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-julia\"\u003E    \u003Cspan class=\"n\"\u003Eargs\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ea\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eb\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]\u003C\u002Fspan\u003E\n    \u003Cspan class=\"nd\"\u003E@match\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ef\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E$\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eargs\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E...\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)))\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Ebegin\u003C\u002Fspan\u003E\n        \u003Cspan class=\"o\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ef\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E$\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eargs\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E...\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)))\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eargs\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E==\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ea\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eb\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003E_\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"kc\"\u003Efalse\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Eend\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E然后你拿到一个\u003Ccode\u003Etrue\u003C\u002Fcode\u003E的输出。\u003C\u002Fp\u003E\u003Cp\u003E要多想。然后看看\u003Ccode\u003Eget_arg_info\u003C\u002Fcode\u003E的最终实现:\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-julia\"\u003E    \u003Cspan class=\"n\"\u003Eget_arg_info\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eex\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"nd\"\u003E@match\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eex\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Ebegin\u003C\u002Fspan\u003E\n         \u003Cspan class=\"o\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E$\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ename\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E$\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eargs\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E...\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E);\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E$\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ekwargs\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E...\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)))\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E||\u003C\u002Fspan\u003E\n         \u003Cspan class=\"o\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E$\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ename\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E$\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eargs\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E...\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)))\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&amp;&amp;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EDo\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ekwargs\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E[])\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eargs\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ekwargs\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\n         \u003Cspan class=\"n\"\u003E_\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ethrow\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"s\"\u003E&#34;invalid input&#34;\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Eend\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E\u003Ccode\u003E||\u003C\u002Fcode\u003E 表示所谓的Or模式(or-pattern)。\u003C\u002Fp\u003E\u003Ch2\u003E缺憾: 函数类型的缺失\u003C\u002Fh2\u003E\u003Cp\u003EJulia对很多领域来说是一门理想的语言，但，不是所有。\u003C\u002Fp\u003E\u003Cp\u003E对那些习惯函数式语言的人，尤其对那种倾向于使用基于类型的高级多态(type class的实现resolve, 隐式类型变量, 高阶类型抽象等), 专门的函数类型是一种基本到不能再基本的东西。\u003C\u002Fp\u003E\u003Cp\u003E断断续续地，我和朋友做了很多尝试，来模拟那些高级的类型多态。但最终我们发现没有隐式推导，仅仅是 动态类型和多重分派还差得很远。\u003C\u002Fp\u003E\u003Cp\u003E在Julia里，每一个函数都有它自己的类型，并且是\u003Ccode\u003EFunction\u003C\u002Fcode\u003E的子类型，阻止来我们在类型层面去抽象函数们的公共 行为。更糟糕的是，这些类型层面对函数的抽象，已经被学界在一万年前证明是无处不在且极为有用的了，还扮演着 一个像是我们学习过程中四则运算一般的角色。\u003C\u002Fp\u003E\u003Cp\u003E在Haskell中，函数的signature会对语义起作用。\u003C\u002Fp\u003E\u003Cp\u003E下面的Haskell代码允许用户对给定的类型，通过这些类型上的性质\u002F特质，来自动生成测试。\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-haskell\"\u003E  \u003Cspan class=\"kr\"\u003Eimport\u003C\u002Fspan\u003E \u003Cspan class=\"nn\"\u003EControl.Arrow\u003C\u002Fspan\u003E\n  \u003Cspan class=\"kr\"\u003Eimport\u003C\u002Fspan\u003E \u003Cspan class=\"nn\"\u003EData.Kind\u003C\u002Fspan\u003E\n\n  \u003Cspan class=\"kr\"\u003Enewtype\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003EMkTest\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"nf\"\u003Ec\u003C\u002Fspan\u003E \u003Cspan class=\"ow\"\u003E::\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E \u003Cspan class=\"ow\"\u003E-&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003EConstraint\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Ea\u003C\u002Fspan\u003E \u003Cspan class=\"ow\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003EMkTest\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\u003Cspan class=\"nf\"\u003ErunTest\u003C\u002Fspan\u003E \u003Cspan class=\"ow\"\u003E::\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Ea\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\n  \u003Cspan class=\"kr\"\u003Eclass\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003ETestCase\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"nf\"\u003Ec\u003C\u002Fspan\u003E \u003Cspan class=\"ow\"\u003E::\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E \u003Cspan class=\"ow\"\u003E-&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003EConstraint\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Ea\u003C\u002Fspan\u003E \u003Cspan class=\"kr\"\u003Ewhere\u003C\u002Fspan\u003E\n      \u003Cspan class=\"nf\"\u003Esamples\u003C\u002Fspan\u003E      \u003Cspan class=\"ow\"\u003E::\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Ec\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Ea\u003C\u002Fspan\u003E \u003Cspan class=\"ow\"\u003E=&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003EMkTest\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Ec\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"nf\"\u003Ea\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]\u003C\u002Fspan\u003E\n      \u003Cspan class=\"nf\"\u003EtestWith\u003C\u002Fspan\u003E     \u003Cspan class=\"ow\"\u003E::\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Ec\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Ea\u003C\u002Fspan\u003E \u003Cspan class=\"ow\"\u003E=&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"nf\"\u003Ea\u003C\u002Fspan\u003E \u003Cspan class=\"ow\"\u003E-&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003EBool\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"ow\"\u003E-&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003EMkTest\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Ec\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E[(\u003C\u002Fspan\u003E\u003Cspan class=\"nf\"\u003Ea\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003EBool\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)]\u003C\u002Fspan\u003E\n      \u003Cspan class=\"nf\"\u003EtestWith\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Elogic\u003C\u002Fspan\u003E \u003Cspan class=\"ow\"\u003E=\u003C\u002Fspan\u003E\n          \u003Cspan class=\"kt\"\u003EMkTest\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E$\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Emap\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"nf\"\u003Eid\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&amp;&amp;&amp;\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Elogic\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Eseq\u003C\u002Fspan\u003E\n          \u003Cspan class=\"kr\"\u003Ewhere\u003C\u002Fspan\u003E\n              \u003Cspan class=\"nf\"\u003Eseq\u003C\u002Fspan\u003E \u003Cspan class=\"ow\"\u003E::\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"nf\"\u003Ea\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]\u003C\u002Fspan\u003E\n              \u003Cspan class=\"nf\"\u003Eseq\u003C\u002Fspan\u003E \u003Cspan class=\"ow\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003ErunTest\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"nf\"\u003Esamples\u003C\u002Fspan\u003E \u003Cspan class=\"ow\"\u003E::\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003EMkTest\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Ec\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"nf\"\u003Ea\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E])\u003C\u002Fspan\u003E\n\n  \u003Cspan class=\"kr\"\u003Etype\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003ETestOn\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Ec\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Ea\u003C\u002Fspan\u003E \u003Cspan class=\"ow\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Ec\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Ea\u003C\u002Fspan\u003E \u003Cspan class=\"ow\"\u003E=&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"nf\"\u003Ea\u003C\u002Fspan\u003E \u003Cspan class=\"ow\"\u003E-&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003EBool\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"ow\"\u003E-&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003EMkTest\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Ec\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E[(\u003C\u002Fspan\u003E\u003Cspan class=\"nf\"\u003Ea\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003EBool\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)]\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E现在我会用Haskell代码来实现一个完美的可扩展的自动测试生成器， 通过下面的实例(Haskell中的术语)， 利用函数类型，来实现当前Julia(v1.1)中无法实现的多态。\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-haskell\"\u003E  \u003Cspan class=\"kr\"\u003Einstance\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003ETestCase\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003EEnum\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Ea\u003C\u002Fspan\u003E \u003Cspan class=\"kr\"\u003Ewhere\u003C\u002Fspan\u003E\n      \u003Cspan class=\"nf\"\u003Esamples\u003C\u002Fspan\u003E \u003Cspan class=\"ow\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003EMkTest\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003EenumFrom\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003EtoEnum\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E$\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E0\u003C\u002Fspan\u003E\n\n  \u003Cspan class=\"kr\"\u003Einstance\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003ETestCase\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003EBounded\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Ea\u003C\u002Fspan\u003E \u003Cspan class=\"kr\"\u003Ewhere\u003C\u002Fspan\u003E\n      \u003Cspan class=\"nf\"\u003Esamples\u003C\u002Fspan\u003E \u003Cspan class=\"ow\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003EMkTest\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"nf\"\u003EmaxBound\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003EminBound\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E]\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E现在我们为\u003Ccode\u003ETestCase\u003C\u002Fcode\u003E在约束(即Type Class)\u003Ccode\u003EEnum\u003C\u002Fcode\u003E和\u003Ccode\u003EBounded\u003C\u002Fcode\u003E上创建实例。\u003C\u002Fp\u003E\u003Cp\u003E对于不熟悉Haskell的读者来说，你可以把Haskell中的约束理解为(Rust中的)trait或者松耦合的interface。\u003C\u002Fp\u003E\u003Cp\u003E一旦类型处于\u003Ccode\u003EEnum\u003C\u002Fcode\u003E的约束下，你就可以枚举它的取值, 以及\u003Ccode\u003EBounded\u003C\u002Fcode\u003E是一种能够确保类型中最大和最小可以访问的约束(通过 \u003Ccode\u003EmaxBound\u003C\u002Fcode\u003E和\u003Ccode\u003EminBound\u003C\u002Fcode\u003E)。\u003Ccode\u003Einstance TestCase Enum a\u003C\u002Fcode\u003E表示对于所有的具体类型(非约束)\u003Ccode\u003Ea\u003C\u002Fcode\u003E，为约束\u003Ccode\u003ETestCase\u003C\u002Fcode\u003E在约束\u003Ccode\u003EEnum\u003C\u002Fcode\u003E 和类型\u003Ccode\u003Ea\u003C\u002Fcode\u003E上建立约束。是的， TestCase也是一种约束, 一个在其他约束和类型上建立约束的约束。\u003C\u002Fp\u003E\u003Cp\u003E目前为止，我们的测试生成器已经搞定来，有点突然，对吧? 这就是Haskell: 务实, 生产力高效。\u003C\u002Fp\u003E\u003Cp\u003E我们可以用上面的代码搞一些测试，利用我们数据类型的性质\u002F特质。\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-haskell\"\u003E  \u003Cspan class=\"nf\"\u003EonEnumerable\u003C\u002Fspan\u003E \u003Cspan class=\"ow\"\u003E::\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003ETestOn\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003EEnum\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Ea\u003C\u002Fspan\u003E\n  \u003Cspan class=\"nf\"\u003EonEnumerable\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Elogic\u003C\u002Fspan\u003E \u003Cspan class=\"ow\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003EtestWith\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Elogic\u003C\u002Fspan\u003E\n\n  \u003Cspan class=\"nf\"\u003EintTest\u003C\u002Fspan\u003E \u003Cspan class=\"ow\"\u003E::\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003EInt\u003C\u002Fspan\u003E \u003Cspan class=\"ow\"\u003E-&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003EInt\u003C\u002Fspan\u003E\n  \u003Cspan class=\"nf\"\u003EintTest\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Ex\u003C\u002Fspan\u003E \u003Cspan class=\"ow\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Ex\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E^\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E2\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E4\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Ex\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E+\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E4\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E==\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"nf\"\u003Ex\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E2\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E^\u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E2\u003C\u002Fspan\u003E\n\n  \u003Cspan class=\"nf\"\u003EboolTest\u003C\u002Fspan\u003E \u003Cspan class=\"ow\"\u003E::\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003EBool\u003C\u002Fspan\u003E \u003Cspan class=\"ow\"\u003E-&gt;\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003EBool\u003C\u002Fspan\u003E\n  \u003Cspan class=\"nf\"\u003EboolTest\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Ex\u003C\u002Fspan\u003E \u003Cspan class=\"ow\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003ETrue\u003C\u002Fspan\u003E\n\n  \u003Cspan class=\"nf\"\u003Emain\u003C\u002Fspan\u003E \u003Cspan class=\"ow\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"kr\"\u003Edo\u003C\u002Fspan\u003E\n    \u003Cspan class=\"nf\"\u003EputStrLn\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Eshow\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Etake\u003C\u002Fspan\u003E \u003Cspan class=\"mi\"\u003E10\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003ErunTest\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E$\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003EonEnumerable\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003EintTest\u003C\u002Fspan\u003E\n    \u003Cspan class=\"nf\"\u003EputStrLn\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003Eshow\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003ErunTest\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E$\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003EonEnumerable\u003C\u002Fspan\u003E \u003Cspan class=\"nf\"\u003EboolTest\u003C\u002Fspan\u003E\n    \u003Cspan class=\"nf\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"nb\"\u003E()\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E这会输出\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003E   [(0,True),(1,True),(2,True),(3,True),(4,True),(5,True),(6,True),(7,True),(8,True),(9,True)]\n   [(False, True), (True, True)]\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E注意我在生成测试集上啥也没做，除了把说明测试逻辑的\u003Ccode\u003EintTest\u003C\u002Fcode\u003E和\u003Ccode\u003EboolTest\u003C\u002Fcode\u003E传过去。我只是 说了我想要测试他们的可枚举特质(\u003Ccode\u003EonEnumerable\u003C\u002Fcode\u003E), 然后多态的自动测试生成器利用函数signature (\u003Ccode\u003EintTest: Int -&gt; Bool\u003C\u002Fcode\u003E, \u003Ccode\u003EboolTest: Bool -&gt; Bool\u003C\u002Fcode\u003E), 然后一切搞定。\u003C\u002Fp\u003E\u003Cp\u003E回到Julia侧，尽管Haskell做了很多隐式操作，多重分派总是可以成功地模拟它(但没有强类型和静态检查)。 问题在于函数类型的缺失，因为我们不能够利用它的类型信息参与分派。\u003C\u002Fp\u003E\u003Cp\u003E下面的思路提供了一些暂时且不完整的解决方案:\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-julia\"\u003E  \u003Cspan class=\"k\"\u003Eimport\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EBase\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Econvert\u003C\u002Fspan\u003E\n  \u003Cspan class=\"k\"\u003Estruct\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EFn\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EArg\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ERet\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EJlFuncType\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n      \u003Cspan class=\"n\"\u003Ef\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EJlFuncType\u003C\u002Fspan\u003E\n  \u003Cspan class=\"k\"\u003Eend\u003C\u002Fspan\u003E\n\n  \u003Cspan class=\"nd\"\u003E@inline\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EFn\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EArg\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ERet\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E}(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ef\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EJlFuncType\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ewhere\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EArg\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ERet\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EJlFuncType\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EFn\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EArg\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ERet\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EJlFuncType\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E}(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ef\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\n  \u003Cspan class=\"nd\"\u003E@generated\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Efunction\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ef\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EFn\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EArg\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ERet\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EJlFuncType\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E})(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ea\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EArg\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ERet\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ewhere\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EArg\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ERet\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EJlFuncType\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Equote\u003C\u002Fspan\u003E\n        \u003Cspan class=\"o\"\u003E$\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"kt\"\u003EExpr\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Emeta\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Einline\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E))\u003C\u002Fspan\u003E\n        \u003Cspan class=\"n\"\u003Ef\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ef\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ea\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Eend\u003C\u002Fspan\u003E\n  \u003Cspan class=\"k\"\u003Eend\u003C\u002Fspan\u003E\n\n  \u003Cspan class=\"n\"\u003Econvert\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EFn\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EArg\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ERet\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EJlFuncType\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E},\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ef\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E::\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EJlFuncType\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Ewhere\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EArg\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ERet\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EJlFuncType\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EFn\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EArg\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ERet\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EJlFuncType\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E}(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ef\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E根据\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fgithub.com\u002Fyuyichao\u002FFunctionWrappers.jl\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003EFunctionWrappers.jl\u003C\u002Fa\u003E, 这是一个相当高效的函数类型实现。\u003C\u002Fp\u003E\u003Cp\u003E然而，问题在于它的使用非常不友好，需要人们进行大量的手工类型标注，这很烦人。\u003C\u002Fp\u003E\u003Cp\u003E对于多态问题的解决尝试, 学术界的主流方案(基于类型的)在Julia这里不能奏效。你得准备收拾收拾 去搞LISP风格的&#34;多态&#34;， 我是说你得经常写宏。\u003C\u002Fp\u003E","adminClosedComment":false,"topics":[{"url":"https:\u002F\u002Fwww.zhihu.com\u002Fapi\u002Fv4\u002Ftopics\u002F19678370","type":"topic","id":"19678370","name":"Julia（编程语言）"},{"url":"https:\u002F\u002Fwww.zhihu.com\u002Fapi\u002Fv4\u002Ftopics\u002F19679700","type":"topic","id":"19679700","name":"编程范式"},{"url":"https:\u002F\u002Fwww.zhihu.com\u002Fapi\u002Fv4\u002Ftopics\u002F19615452","type":"topic","id":"19615452","name":"计算机语言"}],"voteupCount":67,"voting":0,"column":{"description":"可能造轮子有点多。","canManage":true,"intro":"这地方比较杂。","isFollowing":false,"urlToken":"c_103600054","id":"c_103600054","articlesCount":29,"acceptSubmission":true,"title":"红红娘的小码坊","url":"https:\u002F\u002Fzhuanlan.zhihu.com\u002Fc_103600054","commentPermission":"all","created":1496845306,"updated":1504243405,"imageUrl":"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-e4e17a71e65bfa141d3f06c1c8d71f8f_b.jpg","author":{"isFollowed":false,"avatarUrlTemplate":"https:\u002F\u002Fpic4.zhimg.com\u002Fda8e974dc_{size}.jpg","uid":"73724296429568","userType":"people","isFollowing":false,"urlToken":"zhao-wang-hong-xuan","id":"c3a3b37f42ed38a9783c00cea5156e55","description":"blog: https:\u002F\u002Fthautwarm.github.io\u002FSite-32\u002F\n\ngithub, python\u002Fjulia community, reddit: thautwarm\n\n推: redyred","name":"平平淡淡红美铃","isAdvertiser":false,"headline":"编程, 编程语言等话题差劲回答者。","gender":1,"url":"\u002Fpeople\u002Fc3a3b37f42ed38a9783c00cea5156e55","avatarUrl":"https:\u002F\u002Fpic4.zhimg.com\u002Fda8e974dc_l.jpg","isOrg":false,"type":"people"},"followers":462,"type":"column"},"commentCount":9,"contributions":[{"id":20568000,"state":"accepted","type":"first_publish","column":{"description":"可能造轮子有点多。","canManage":true,"intro":"这地方比较杂。","isFollowing":false,"urlToken":"c_103600054","id":"c_103600054","articlesCount":29,"acceptSubmission":true,"title":"红红娘的小码坊","url":"https:\u002F\u002Fzhuanlan.zhihu.com\u002Fc_103600054","commentPermission":"all","created":1496845306,"updated":1504243405,"imageUrl":"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-e4e17a71e65bfa141d3f06c1c8d71f8f_b.jpg","author":{"isFollowed":false,"avatarUrlTemplate":"https:\u002F\u002Fpic4.zhimg.com\u002Fda8e974dc_{size}.jpg","uid":"73724296429568","userType":"people","isFollowing":false,"urlToken":"zhao-wang-hong-xuan","id":"c3a3b37f42ed38a9783c00cea5156e55","description":"blog: https:\u002F\u002Fthautwarm.github.io\u002FSite-32\u002F\n\ngithub, python\u002Fjulia community, reddit: thautwarm\n\n推: redyred","name":"平平淡淡红美铃","isAdvertiser":false,"headline":"编程, 编程语言等话题差劲回答者。","gender":1,"url":"\u002Fpeople\u002Fc3a3b37f42ed38a9783c00cea5156e55","avatarUrl":"https:\u002F\u002Fpic4.zhimg.com\u002Fda8e974dc_l.jpg","isOrg":false,"type":"people"},"followers":462,"type":"column"}},{"id":20568002,"state":"accepted","type":"include","column":{"description":"哦","canManage":true,"intro":"Exlixir, Python & Julia.","isFollowing":false,"urlToken":"c_123687550","id":"c_123687550","articlesCount":4,"acceptSubmission":true,"title":"啃面包和动态语言","url":"https:\u002F\u002Fzhuanlan.zhihu.com\u002Fc_123687550","commentPermission":"all","created":1504183513,"updated":1504244137,"imageUrl":"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-9e3b70db749ea5002800fc20420f6cac_b.jpg","author":{"isFollowed":false,"avatarUrlTemplate":"https:\u002F\u002Fpic4.zhimg.com\u002Fda8e974dc_{size}.jpg","uid":"73724296429568","userType":"people","isFollowing":false,"urlToken":"zhao-wang-hong-xuan","id":"c3a3b37f42ed38a9783c00cea5156e55","description":"blog: https:\u002F\u002Fthautwarm.github.io\u002FSite-32\u002F\n\ngithub, python\u002Fjulia community, reddit: thautwarm\n\n推: redyred","name":"平平淡淡红美铃","isAdvertiser":false,"headline":"编程, 编程语言等话题差劲回答者。","gender":1,"url":"\u002Fpeople\u002Fc3a3b37f42ed38a9783c00cea5156e55","avatarUrl":"https:\u002F\u002Fpic4.zhimg.com\u002Fda8e974dc_l.jpg","isOrg":false,"type":"people"},"followers":104,"type":"column"}}],"isTitleImageFullScreen":false,"upvotedFollowees":[],"commercialInfo":{"isCommercial":false,"plugin":{}},"suggestEdit":{"status":false,"reason":"","tip":"","url":"","title":""},"reason":"","annotationAction":[],"canTip":true,"tipjarorsCount":0,"isLabeled":false,"hasPublishingDraft":false,"isFavorited":false,"isNormal":true,"status":0,"activityToppingInfo":{"state":"untopped"},"shareText":"高观点下的Julia泛用编程 - 来自知乎专栏「红红娘的小码坊」，作者: 平平淡淡红美铃 https:\u002F\u002Fzhuanlan.zhihu.com\u002Fp\u002F61537058 （想看更多？下载 @知乎 App：http:\u002F\u002Fweibo.com\u002Fp\u002F100404711598 ）","canComment":{"status":true,"reason":""}}},"columns":{"c_103600054":{"description":"可能造轮子有点多。","canManage":true,"intro":"这地方比较杂。","isFollowing":false,"urlToken":"c_103600054","id":"c_103600054","articlesCount":29,"acceptSubmission":true,"title":"红红娘的小码坊","url":"https:\u002F\u002Fzhuanlan.zhihu.com\u002Fc_103600054","commentPermission":"all","created":1496845306,"updated":1504243405,"imageUrl":"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-e4e17a71e65bfa141d3f06c1c8d71f8f_b.jpg","author":{"isFollowed":false,"avatarUrlTemplate":"https:\u002F\u002Fpic4.zhimg.com\u002Fda8e974dc_{size}.jpg","uid":"73724296429568","userType":"people","isFollowing":false,"urlToken":"zhao-wang-hong-xuan","id":"c3a3b37f42ed38a9783c00cea5156e55","description":"blog: https:\u002F\u002Fthautwarm.github.io\u002FSite-32\u002F\n\ngithub, python\u002Fjulia community, reddit: thautwarm\n\n推: redyred","name":"平平淡淡红美铃","isAdvertiser":false,"headline":"编程, 编程语言等话题差劲回答者。","gender":1,"url":"\u002Fpeople\u002Fc3a3b37f42ed38a9783c00cea5156e55","avatarUrl":"https:\u002F\u002Fpic4.zhimg.com\u002Fda8e974dc_l.jpg","isOrg":false,"type":"people"},"followers":462,"type":"column"},"c_123687550":{"description":"哦","canManage":true,"intro":"Exlixir, Python & Julia.","isFollowing":false,"urlToken":"c_123687550","id":"c_123687550","articlesCount":4,"acceptSubmission":true,"title":"啃面包和动态语言","url":"https:\u002F\u002Fzhuanlan.zhihu.com\u002Fc_123687550","commentPermission":"all","created":1504183513,"updated":1504244137,"imageUrl":"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-9e3b70db749ea5002800fc20420f6cac_b.jpg","author":{"isFollowed":false,"avatarUrlTemplate":"https:\u002F\u002Fpic4.zhimg.com\u002Fda8e974dc_{size}.jpg","uid":"73724296429568","userType":"people","isFollowing":false,"urlToken":"zhao-wang-hong-xuan","id":"c3a3b37f42ed38a9783c00cea5156e55","description":"blog: https:\u002F\u002Fthautwarm.github.io\u002FSite-32\u002F\n\ngithub, python\u002Fjulia community, reddit: thautwarm\n\n推: redyred","name":"平平淡淡红美铃","isAdvertiser":false,"headline":"编程, 编程语言等话题差劲回答者。","gender":1,"url":"\u002Fpeople\u002Fc3a3b37f42ed38a9783c00cea5156e55","avatarUrl":"https:\u002F\u002Fpic4.zhimg.com\u002Fda8e974dc_l.jpg","isOrg":false,"type":"people"},"followers":104,"type":"column"}},"topics":{},"roundtables":{},"favlists":{},"comments":{},"notifications":{},"ebooks":{},"activities":{},"feeds":{},"pins":{},"promotions":{},"drafts":{},"chats":{}},"currentUser":"c3a3b37f42ed38a9783c00cea5156e55","account":{"lockLevel":{},"unlockTicketStatus":false,"unlockTicket":null,"challenge":[],"errorStatus":false,"message":"","isFetching":false,"accountInfo":{},"urlToken":{"loading":false}},"settings":{"socialBind":null,"inboxMsg":null,"notification":{},"email":{},"privacyFlag":null,"blockedUsers":{"isFetching":false,"paging":{"pageNo":1,"pageSize":6},"data":[]},"blockedFollowees":{"isFetching":false,"paging":{"pageNo":1,"pageSize":6},"data":[]},"ignoredTopics":{"isFetching":false,"paging":{"pageNo":1,"pageSize":6},"data":[]},"restrictedTopics":null,"laboratory":{}},"notification":{},"people":{"profileStatus":{},"activitiesByUser":{},"answersByUser":{},"answersSortByVotesByUser":{},"answersIncludedByUser":{},"votedAnswersByUser":{},"thankedAnswersByUser":{},"voteAnswersByUser":{},"thankAnswersByUser":{},"topicAnswersByUser":{},"articlesByUser":{},"articlesSortByVotesByUser":{},"articlesIncludedByUser":{},"pinsByUser":{},"questionsByUser":{},"commercialQuestionsByUser":{},"favlistsByUser":{},"followingByUser":{},"followersByUser":{},"mutualsByUser":{},"followingColumnsByUser":{},"followingQuestionsByUser":{},"followingFavlistsByUser":{},"followingTopicsByUser":{},"publicationsByUser":{},"columnsByUser":{},"allFavlistsByUser":{},"brands":null,"creationsByUser":{},"creationsSortByVotesByUser":{}},"env":{"ab":{"config":{"experiments":[{"expId":"launch-gw_ydyq-2","expPrefix":"gw_ydyq","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false},{"expId":"launch-nw_zhuantigaiban-2","expPrefix":"nw_zhuantigaiban","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false},{"expId":"launch-qa_answer_update-2","expPrefix":"qa_answer_update","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false},{"expId":"launch-rec_book_chapter-4","expPrefix":"rec_book_chapter","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false},{"expId":"launch-rec_es_update-3","expPrefix":"rec_es_update","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false},{"expId":"launch-se_ios_spb309-5","expPrefix":"se_ios_spb309","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false},{"expId":"launch-se_ir-2","expPrefix":"se_ir","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false},{"expId":"launch-se_ltr_v011-4","expPrefix":"se_ltr_v011","isDynamicallyUpdated":false,"isRuntime":false,"includeTriggerInfo":false},{"expId":"launch-se_payconsult-3","expPrefix":"se_payconsult","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false},{"expId":"launch-se_payc_click2-3","expPrefix":"se_payc_click2","isDynamicallyUpdated":true,"isRuntime":true,"includeTriggerInfo":false},{"expId":"launch-se_subtext-2","expPrefix":"se_subtext","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false},{"expId":"launch-se_webtimebox-2","expPrefix":"se_webtimebox","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false},{"expId":"launch-se_whitelist-2","expPrefix":"se_whitelist","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false},{"expId":"launch-top_hotchild-2","expPrefix":"top_hotchild","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false},{"expId":"launch-tp_and_sticky-2","expPrefix":"tp_and_sticky","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false},{"expId":"launch-us_bigone-10","expPrefix":"us_bigone","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false},{"expId":"launch-us_foltopic_user-10","expPrefix":"us_foltopic_user","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false},{"expId":"launch-us_newguide3-11","expPrefix":"us_newguide3","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false},{"expId":"launch-us_n_web_msg-5","expPrefix":"us_n_web_msg","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false},{"expId":"launch-vd_griffith-2","expPrefix":"vd_griffith","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false},{"expId":"li_hot_score_ab-3","expPrefix":"li_hot_score_ab","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false},{"expId":"li_price_test-7","expPrefix":"li_price_test","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false},{"expId":"vd_videoad-2","expPrefix":"vd_videoad","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false},{"expId":"se_expire_ob-1","expPrefix":"se_expire_ob","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false},{"expId":"se_likebutton-1","expPrefix":"se_likebutton","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false},{"expId":"se_payc_click-2","expPrefix":"se_payc_click","isDynamicallyUpdated":true,"isRuntime":true,"includeTriggerInfo":false},{"expId":"us_bignew-2","expPrefix":"us_bignew","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false},{"expId":"us_update-10","expPrefix":"us_update","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false},{"expId":"top_native_ans-13","expPrefix":"top_native_ans","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false},{"expId":"top_recall_expr-7","expPrefix":"top_recall_expr","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false},{"expId":"top_vipconsume-8","expPrefix":"top_vipconsume","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false},{"expId":"top_hotcommerce-1","expPrefix":"top_hotcommerce","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false},{"expId":"top_gr_ab_exp-7","expPrefix":"top_gr_ab_exp","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false},{"expId":"top_recall_v2-10","expPrefix":"top_recall_v2","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false},{"expId":"top_hotctr-9","expPrefix":"top_hotctr","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false},{"expId":"rec_km_xgb_model-1","expPrefix":"rec_km_xgb_model","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false}],"params":[{"id":"web_column_auto_invite","type":"String","value":"0"},{"id":"zr_ans_rec","type":"String","value":"gbrank","chainId":"_all_"},{"id":"zr_km_answer","type":"String","value":"open_cvr","chainId":"_all_"},{"id":"tp_m_intro_re_topic","type":"String","value":"1","chainId":"_all_"},{"id":"ug_follow_answerer_0","type":"String","value":"0","chainId":"_all_"},{"id":"se_title_only","type":"String","value":"0","chainId":"_all_"},{"id":"se_zu_recommend","type":"String","value":"0","chainId":"_all_"},{"id":"soc_update","type":"String","value":"0","chainId":"_all_"},{"id":"se_auto_syn","type":"String","value":"0","chainId":"_all_"},{"id":"se_rr","type":"String","value":"1","chainId":"_all_"},{"id":"se_webmajorob","type":"String","value":"0","chainId":"_all_"},{"id":"tsp_hotctr","type":"String","value":"1","chainId":"_all_"},{"id":"web_sem_ab","type":"String","value":"0"},{"id":"li_qa_cover","type":"String","value":"old","chainId":"_all_"},{"id":"se_agency","type":"String","value":" 0","chainId":"_all_"},{"id":"zr_video_recall","type":"String","value":"current_recall","chainId":"_all_"},{"id":"li_ebook_detail","type":"String","value":"1","chainId":"_all_"},{"id":"se_terminate","type":"String","value":"0","chainId":"_all_"},{"id":"tp_header_style","type":"String","value":"1","chainId":"_all_"},{"id":"web_answer_update","type":"String","value":"1"},{"id":"zr_infinity_a_u","type":"String","value":"close","chainId":"_all_"},{"id":"gue_anonymous","type":"String","value":"show"},{"id":"se_topiclabel","type":"String","value":"0","chainId":"_all_"},{"id":"se_likebutton","type":"String","value":"0","chainId":"_all_"},{"id":"se_p_slideshow","type":"String","value":"0","chainId":"_all_"},{"id":"li_qa_new_cover","type":"String","value":"0","chainId":"_all_"},{"id":"pf_creator_card","type":"String","value":"1","chainId":"_all_"},{"id":"se_webtimebox","type":"String","value":"1","chainId":"_all_"},{"id":"top_recall_deep_user","type":"String","value":"1","chainId":"_all_"},{"id":"se_amovietab","type":"String","value":"1","chainId":"_all_"},{"id":"se_ios_spb309","type":"String","value":"1","chainId":"_all_"},{"id":"tp_qa_metacard","type":"String","value":"1","chainId":"_all_"},{"id":"zr_search_xgb","type":"String","value":"0","chainId":"_all_"},{"id":"pf_newguide_vertical","type":"String","value":"0","chainId":"_all_"},{"id":"top_universalebook","type":"String","value":"1","chainId":"_all_"},{"id":"se_movietab","type":"String","value":"1","chainId":"_all_"},{"id":"se_featured","type":"String","value":"1","chainId":"_all_"},{"id":"se_lottery","type":"String","value":"0","chainId":"_all_"},{"id":"se_site_onebox","type":"String","value":"0","chainId":"_all_"},{"id":"web_question_invite","type":"String","value":"B"},{"id":"zr_km_style","type":"String","value":"base","chainId":"_all_"},{"id":"zr_video_rank_nn","type":"String","value":"current_rank","chainId":"_all_"},{"id":"pf_foltopic_usernum","type":"String","value":"50","chainId":"_all_"},{"id":"se_page_limit_20","type":"String","value":"1","chainId":"_all_"},{"id":"pf_feed","type":"String","value":"1","chainId":"_all_"},{"id":"se_mobileweb","type":"String","value":"1","chainId":"_all_"},{"id":"li_album_liutongab","type":"String","value":"0","chainId":"_all_"},{"id":"ls_new_upload","type":"String","value":"0","chainId":"_all_"},{"id":"ls_fmp4","type":"String","value":"1","chainId":"_all_"},{"id":"ug_goodcomment_0","type":"String","value":"1","chainId":"_all_"},{"id":"tp_sft_v2","type":"String","value":"d","chainId":"_all_"},{"id":"tp_sticky_android","type":"String","value":"2","chainId":"_all_"},{"id":"se_pyc_click2","type":"String","value":"2","chainId":"_all_"},{"id":"top_gr_ab","type":"String","value":"7","chainId":"_all_"},{"id":"se_subtext","type":"String","value":"1","chainId":"_all_"},{"id":"se_zu_onebox","type":"String","value":"0","chainId":"_all_"},{"id":"top_native_answer","type":"String","value":"6","chainId":"_all_"},{"id":"gue_zhuantikapian","type":"String","value":"0"},{"id":"se_ad_index","type":"String","value":"10","chainId":"_all_"},{"id":"top_reason","type":"String","value":"1","chainId":"_all_"},{"id":"pf_noti_entry_num","type":"String","value":"0","chainId":"_all_"},{"id":"se_webrs","type":"String","value":"1","chainId":"_all_"},{"id":"top_recall_exp_v2","type":"String","value":"10","chainId":"_all_"},{"id":"tsp_childbillboard","type":"String","value":"2","chainId":"_all_"},{"id":"web_answer_list_ad","type":"String","value":"1"},{"id":"se_new_topic","type":"String","value":"0","chainId":"_all_"},{"id":"top_quality","type":"String","value":"0","chainId":"_all_"},{"id":"tp_meta_card","type":"String","value":"0","chainId":"_all_"},{"id":"ug_follow_topic_1","type":"String","value":"2","chainId":"_all_"},{"id":"web_wx_block","type":"String","value":"2"},{"id":"zr_ebook_chapter","type":"String","value":"1","chainId":"_all_"},{"id":"li_price_test","type":"String","value":"3","chainId":"_all_"},{"id":"se_time_threshold","type":"String","value":"0","chainId":"_all_"},{"id":"tp_qa_metacard_top","type":"String","value":"top","chainId":"_all_"},{"id":"tp_sft","type":"String","value":"a","chainId":"_all_"},{"id":"se_preset_tech","type":"String","value":"0","chainId":"_all_"},{"id":"se_search_feed","type":"String","value":"N","chainId":"_all_"},{"id":"se_college_cm","type":"String","value":"0","chainId":"_all_"},{"id":"qa_answerlist_ad","type":"String","value":"0","chainId":"_all_"},{"id":"se_ltr_v002","type":"String","value":"1","chainId":"_all_"},{"id":"se_waterfall","type":"String","value":"0","chainId":"_all_"},{"id":"soc_bignew","type":"String","value":"1","chainId":"_all_"},{"id":"top_hotcommerce","type":"String","value":"1","chainId":"_all_"},{"id":"top_rank","type":"String","value":"0","chainId":"_all_"},{"id":"li_tjys_ec_ab","type":"String","value":"0","chainId":"_all_"},{"id":"ls_videoad","type":"String","value":"1","chainId":"_all_"},{"id":"zr_es_update","type":"String","value":"1","chainId":"_all_"},{"id":"top_vipconsume","type":"String","value":"3","chainId":"_all_"},{"id":"web_answerlist_ad","type":"String","value":"0"},{"id":"se_limit","type":"String","value":"0","chainId":"_all_"},{"id":"se_topicdirect","type":"String","value":"2","chainId":"_all_"},{"id":"zr_km_xgb_model","type":"String","value":"old","chainId":"_all_"},{"id":"zr_video_rank","type":"String","value":"new_rank","chainId":"_all_"},{"id":"se_billboardsearch","type":"String","value":"0","chainId":"_all_"},{"id":"se_college","type":"String","value":"default","chainId":"_all_"},{"id":"soc_special","type":"String","value":"0","chainId":"_all_"},{"id":"top_ebook","type":"String","value":"0","chainId":"_all_"},{"id":"pf_fuceng","type":"String","value":"1","chainId":"_all_"},{"id":"se_payconsult","type":"String","value":"5","chainId":"_all_"},{"id":"top_v_album","type":"String","value":"1","chainId":"_all_"},{"id":"web_heifetz_grow_ad","type":"String","value":"1"},{"id":"se_go_ztext","type":"String","value":"0","chainId":"_all_"},{"id":"se_whitelist","type":"String","value":"1","chainId":"_all_"},{"id":"top_recall_exp_v1","type":"String","value":"7","chainId":"_all_"},{"id":"zr_article_rec_rank","type":"String","value":"close","chainId":"_all_"},{"id":"li_hot_score_ab","type":"String","value":"1","chainId":"_all_"},{"id":"li_ts_sample","type":"String","value":"old","chainId":"_all_"},{"id":"se_websearch","type":"String","value":"3","chainId":"_all_"},{"id":"top_new_feed","type":"String","value":"5","chainId":"_all_"},{"id":"tp_qa_toast","type":"String","value":"1","chainId":"_all_"},{"id":"ug_fw_answ_aut_1","type":"String","value":"0","chainId":"_all_"},{"id":"zr_km_slot_style","type":"String","value":"event_card","chainId":"_all_"},{"id":"li_se_new_fields","type":"String","value":"0","chainId":"_all_"},{"id":"se_wannasearch","type":"String","value":"0","chainId":"_all_"},{"id":"se_ltr_v010","type":"String","value":"1","chainId":"_all_"},{"id":"ug_follow_answerer","type":"String","value":"0","chainId":"_all_"},{"id":"ug_zero_follow","type":"String","value":"0","chainId":"_all_"},{"id":"li_android_vip","type":"String","value":"0","chainId":"_all_"},{"id":"qa_test","type":"String","value":"0","chainId":"_all_"},{"id":"top_root","type":"String","value":"0","chainId":"_all_"},{"id":"gue_new_special_page","type":"String","value":"1"},{"id":"li_album3_ab","type":"String","value":"0","chainId":"_all_"},{"id":"se_topic_express","type":"String","value":"0","chainId":"_all_"},{"id":"soc_bigone","type":"String","value":"1","chainId":"_all_"},{"id":"ug_zero_follow_0","type":"String","value":"0","chainId":"_all_"},{"id":"se_ltr_v011","type":"String","value":"1","chainId":"_all_"},{"id":"se_payconsult_click","type":"String","value":"0","chainId":"_all_"},{"id":"se_ri","type":"String","value":"0","chainId":"_all_"},{"id":"se_spb309","type":"String","value":"0","chainId":"_all_"},{"id":"top_test_4_liguangyi","type":"String","value":"1","chainId":"_all_"},{"id":"ug_newtag","type":"String","value":"1","chainId":"_all_"},{"id":"se_backsearch","type":"String","value":"0","chainId":"_all_"},{"id":"se_colorfultab","type":"String","value":"1","chainId":"_all_"},{"id":"zr_rel_search","type":"String","value":"base","chainId":"_all_"},{"id":"se_expired_ob","type":"String","value":"0","chainId":"_all_"},{"id":"web_n_web_msg","type":"String","value":"1"},{"id":"tsp_lastread","type":"String","value":"0","chainId":"_all_"},{"id":"zr_art_rec","type":"String","value":"base","chainId":"_all_"},{"id":"se_famous","type":"String","value":"1","chainId":"_all_"},{"id":"top_ydyq","type":"String","value":"A","chainId":"_all_"}],"chains":[{"chainId":"_all_"}]},"triggers":{}},"userAgent":{"Edge":false,"Wechat":false,"Weibo":false,"QQ":false,"MQQBrowser":false,"Qzone":false,"Mobile":false,"Android":false,"iOS":false,"isAppleDevice":false,"Zhihu":false,"ZhihuHybrid":false,"isBot":false,"Tablet":false,"UC":false,"Sogou":false,"Qihoo":false,"Baidu":false,"BaiduApp":false,"Safari":false,"GoogleBot":false,"isWebView":false,"origin":"Mozilla\u002F5.0 (X11; Linux x86_64) AppleWebKit\u002F537.36 (KHTML, like Gecko) Chrome\u002F75.0.3770.100 Safari\u002F537.36"},"ctx":{"path":"\u002Fp\u002F61537058"},"trafficSource":"production","edition":{"baidu":false,"sogou":false,"baiduBeijing":false,"sogouBeijing":false},"theme":"light","enableShortcut":true,"referer":"","conf":{},"ipInfo":{"cityName":"Mianyang","countryName":"China","regionName":"Sichuan","countryCode":"CN"},"logged":true,"tdkInfo":{}},"me":{"accountInfoLoadStatus":{},"organizationProfileStatus":{},"columnContributions":[]},"label":{"recognizerLists":{}},"ecommerce":{},"comments":{"pagination":{},"collapsed":{},"reverse":{},"reviewing":{},"conversation":{},"parent":{}},"commentsV2":{"stickers":[],"commentWithPicPermission":{},"notificationsComments":{},"pagination":{},"collapsed":{},"reverse":{},"reviewing":{},"conversation":{},"conversationMore":{},"parent":{}},"pushNotifications":{"default":{"isFetching":false,"isDrained":false,"ids":[]},"follow":{"isFetching":false,"isDrained":false,"ids":[]},"vote_thank":{"isFetching":false,"isDrained":false,"ids":[]},"currentTab":"default","notificationsCount":{"default":0,"follow":0,"vote_thank":0}},"messages":{"data":{},"currentTab":"common","messageCount":0},"register":{"registerValidateSucceeded":null,"registerValidateErrors":{},"registerConfirmError":null,"sendDigitsError":null,"registerConfirmSucceeded":null},"login":{"loginUnregisteredError":false,"loginBindWechatError":false,"loginConfirmError":null,"sendDigitsError":null,"validateDigitsError":false,"loginConfirmSucceeded":null,"qrcodeLoginToken":"","qrcodeLoginScanStatus":0,"qrcodeLoginError":null,"qrcodeLoginReturnNewToken":false},"active":{"sendDigitsError":null,"activeConfirmSucceeded":null,"activeConfirmError":null},"switches":{},"captcha":{"captchaNeeded":false,"captchaValidated":false,"captchaBase64String":null,"captchaValidationMessage":null,"loginCaptchaExpires":false},"sms":{"supportedCountries":[]},"chat":{"chats":{},"inbox":{"recents":{"isFetching":false,"isDrained":false,"isPrevDrained":false,"result":[],"next":null,"key":null},"strangers":{"isFetching":false,"isDrained":false,"isPrevDrained":false,"result":[],"next":null,"key":null},"friends":{"isFetching":false,"isDrained":false,"isPrevDrained":false,"result":[],"next":null,"key":null},"search":{"isFetching":false,"isDrained":false,"isPrevDrained":false,"result":[],"next":null,"key":null},"config":{"newCount":0,"strangerMessageSwitch":false,"strangerMessageUnread":false,"friendCount":0}},"global":{"isChatMqttExisted":false}},"emoticons":{"emoticonGroupList":[],"emoticonGroupDetail":{}},"recommendation":{"homeRecommendations":[]},"shareTexts":{},"articles":{"voters":{}},"previewPost":{},"favlists":{"relations":{}},"columns":{"voters":{}},"reward":{"answer":{},"article":{},"question":{}},"video":{"data":{},"shareVideoDetail":{},"last":{}},"topstory":{"recommend":{"isFetching":false,"isDrained":false,"afterId":0,"items":[],"next":null},"follow":{"isFetching":false,"isDrained":false,"afterId":0,"items":[],"next":null},"followWonderful":{"isFetching":false,"isDrained":false,"afterId":0,"items":[],"next":null},"sidebar":null,"announcement":{},"hotListCategories":[],"hotList":[],"guestFeeds":{"isFetching":false,"isDrained":false,"afterId":0,"items":[],"next":null},"followExtra":{"isNewUser":null,"isFetched":false,"followCount":0,"followers":[]}},"readStatus":{},"column":{},"requestColumn":{"categories":[],"error":null},"articleContribution":{"contributeRequests":[],"deleteContributeIdList":[],"handledContributeIdList":[],"recommendedColumns":[],"pinnedColumns":[],"sentContributeRequestsIdList":[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,"c_103600054","c_123687550"]},"columnContribution":{"contributeRequests":[],"autoInviteEnabled":false,"recommendedContributors":[],"contributionInvitation":null},"draftHistory":{"history":{},"drafts":{}},"upload":{},"articleDraft":{"titleImage":"","titleImageSize":{},"isTitleImageFullScreen":false,"canTitleImageFullScreen":false,"title":"","titleImageUploading":false,"error":"","content":"","draftLoading":false,"updating":false,"globalLoading":false,"pendingVideo":{"resource":null,"error":null},"deleteFail":{"fail":false},"recommendTopics":[],"selectedColumn":0},"articleDrafts":{"isDrained":false,"isLoading":false,"items":[]},"columnAutocomplete":{"users":[],"friends":[]}},"fetchHost":"www.zhihu.com","subAppName":"column"}</script><script></script></body>

    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2019, thautwarm.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.1.2.<br/>
    </p>
  </div>
</footer>
  </body>
</html>